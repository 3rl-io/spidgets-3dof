!function e(t,r,i){function n(a,o){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var u=r[a]={exports:{}};t[a][0].call(u.exports,(function(e){return n(t[a][1][e]||e)}),u,u.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t,r){"use strict";var i=[],n=function(e,t){var r=document.head||document.getElementsByTagName("head")[0],n=i[i.length-1];if((t=t||{}).insertAt=t.insertAt||"bottom","top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),i.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(e)}};t.exports={createLink:function(e,t){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("link");for(var n in i.href=e,i.rel="stylesheet",t)if(t.hasOwnProperty(n)){var s=t[n];i.setAttribute("data-"+n,s)}r.appendChild(i)},createStyle:function(e,t,r){r=r||{};var i=document.createElement("style");for(var s in i.type="text/css",t)if(t.hasOwnProperty(s)){var a=t[s];i.setAttribute("data-"+s,a)}i.sheet?(i.innerHTML=e,i.sheet.cssText=e,n(i,{insertAt:r.insertAt})):i.styleSheet?(n(i,{insertAt:r.insertAt}),i.styleSheet.cssText=e):(i.appendChild(document.createTextNode(e)),n(i,{insertAt:r.insertAt}))}}},{}],2:[function(e,t,r){let i={};function n(e,t){return r=>{r.colorSpace=THREE.SRGBColorSpace,r.mapping=THREE.EquirectangularReflectionMapping,e&&(i[e]=r),t.object3D.background=r}}e("./directive").registerDirective("background",{schema:{type:"string"},update(){const e=this.el;if(!e.renderer)return void console.error("background may only applied to the scene");const t=this.data;t&&t.includes(".")?(i[t]?n(null,e)(i[t]):(new THREE.TextureLoader).load(t,n(t,e)),e.solidBg=!1):"transparent"===t?(e.object3D.background=null,e.solidBg=!0):(e.object3D.background=new THREE.Color(t),e.solidBg=!0)}})},{"./directive":4}],3:[function(e,t,r){t.exports.Directive=e("./directive").registerDirective("camera",{schema:{far:{default:1500},fov:{default:36,min:0},near:{default:1,min:0},zoom:{default:1.5,min:0}},init(){this.el.setObject3D("camera",this.el.sceneEl.camera=new THREE.PerspectiveCamera),this.el.sceneEl.emit("cameraready",{cameraEl:this})},update(){const e=this.data,t=this.el.sceneEl.camera;Object.assign(t,{aspect:e.aspect||window.innerWidth/window.innerHeight,far:e.far,fov:e.fov,near:e.near,zoom:e.zoom}),t.updateProjectionMatrix()},remove(){this.el.removeObject3D("camera")}})},{"./directive":4}],4:[function(e,t,r){const i=e("../utils/parsing/schema"),n=e("../utils");let s=t.exports.directives={};const a=i.parseProperties,o=i.parseProperty,l=n.styleParser;let h={};var u=function(e,t){const r=this;r.el=e,r.attrName=r.name,r.initialized=!1,r.isSingleProperty=i.isSingleProperty(r.schema),r.isSinglePropertyObject=r.isSingleProperty&&p(o(void 0,r.schema))&&!(r.schema.default instanceof window.HTMLElement),r.isObjectBased=!r.isSingleProperty||r.isSinglePropertyObject,r.objectPool=h[r.name],r.isObjectBased&&(r.nextData=r.objectPool.use(),n.objectPool.removeUnusedKeys(r.nextData,r.schema),r.oldData=r.objectPool.use(),n.objectPool.removeUnusedKeys(r.oldData,r.schema),r.previousOldData=r.objectPool.use(),n.objectPool.removeUnusedKeys(r.previousOldData,r.schema),r.parsingAttrValue=r.objectPool.use(),n.objectPool.removeUnusedKeys(r.parsingAttrValue,r.schema)),r.updateProperties(t)};function c(e,t){for(let r in t)if(t[r]){let i=t[r];e[r]=f(i)?n.clone(i):i}return e}function d(e,t,r){if(r&&t&&t.constructor&&t.constructor===Object){for(let r in t)t[r]&&(t[r].constructor===Object?e[r]=n.clone(t[r]):e[r]=t[r]);return e}return t}function p(e){return e&&e.constructor===Object&&!(e instanceof window.HTMLElement)}function f(e){return e&&(e.constructor===Object||e.constructor===Array)&&!(e instanceof window.HTMLElement)}u.prototype={schema:{},init(){},update(e){},updateSchema(){},play(){},pause(){},remove(){},updateCachedAttrValue(e,t){if(void 0===e)return;if(null===e)return this.isObjectBased&&this.attrValue&&this.objectPool.recycle(this.attrValue),void(this.attrValue=void 0);let r;if(r=e instanceof Object&&!(e instanceof window.HTMLElement)?e:this.parseAttrValueForCache(e),this.isObjectBased&&!t&&this.attrValue)for(let e in this.attrValue)void 0===r[e]&&(r[e]=this.attrValue[e]);this.isObjectBased&&!this.attrValue&&(this.attrValue=this.objectPool.use()),n.objectPool.clearObject(this.attrValue),this.attrValue=d(this.attrValue,r,this.isObjectBased)},parseAttrValueForCache(e){let t;return"string"!=typeof e?e:(this.isSingleProperty?(t=this.schema.parse(e),"string"==typeof t&&(t=e)):(n.objectPool.clearObject(this.parsingAttrValue),t=l.parse(e,this.parsingAttrValue)),t)},updateProperties(e,t){this.el.hasLoaded?(null!==e&&(e=this.parseAttrValueForCache(e)),this.updateCachedAttrValue(e,t),this.initialized?(this.updateDirective(e,t),this.callUpdateHandler()):this.initDirective()):this.updateCachedAttrValue(e)},initDirective(){let e=this.el.initializingDirectives;if(this.updateSchema(this.buildData(this.attrValue,!1,!0)),this.data=this.buildData(this.attrValue),e[this.name])return;e[this.name]=!0,this.init(),this.initialized=!0,delete e[this.name],this.oldData=d(this.oldData,this.data,this.isObjectBased);let t=this.isObjectBased?this.objectPool.use():void 0;this.update(t),this.isObjectBased&&this.objectPool.recycle(t),this.el.isPlaying&&this.play(),this.el.emit("directiveinitialized",{name:this.name},!1)},updateDirective(e,t){if(t)return this.updateSchema(this.buildData(this.attrValue,!0,!0)),void(this.data=this.buildData(this.attrValue,!0,!1));if(this.isSingleProperty)return this.isObjectBased&&o(e,this.schema),void(this.data=e);a(e,this.schema,!0,this.name);for(let t in e)e[t]&&(this.data[t]=e[t])},callUpdateHandler(){this.previousOldData instanceof Object&&n.objectPool.clearObject(this.previousOldData),this.isObjectBased?c(this.previousOldData,this.oldData):this.previousOldData=this.oldData,this.oldData instanceof Object&&n.objectPool.clearObject(this.oldData),this.oldData=d(this.oldData,this.data,this.isObjectBased),this.update(this.previousOldData)},buildData(e,t,r){let i,s=this.nextData;const l=this.schema;let h;if(this.isObjectBased&&n.objectPool.clearObject(s),this.isSingleProperty)i=this.isObjectBased?c(s,l.default):f(l.default)?n.clone(l.default):l.default;else{h=!t&&this.attrValue,i=h instanceof Object?c(s,h):s;for(let e in l){let t=l[e].default;i[e]&&(i[e]=f(t)?n.clone(t):t)}}if(e&&e.constructor===Array?e.length:null!=e){if(this.isSingleProperty)return p(e)?(c(this.parsingAttrValue,e),o(this.parsingAttrValue,l)):o(e,l);i=d(i,e,this.isObjectBased)}else if(this.isSingleProperty)return o(i,l);return a(i,l,void 0,this.name,r)},destroy(){this.objectPool.recycle(this.attrValue),this.objectPool.recycle(this.oldData),this.objectPool.recycle(this.parsingAttrValue),this.attrValue=this.oldData=this.parsingAttrValue=void 0}},t.exports.registerDirective=function(e,t){let r=function(e,t){u.call(this,e,t)},a={};var o,l;Object.keys(t).forEach((function(e){a[e]={value:t[e],writable:!0}})),(r.prototype=Object.create(u.prototype,a)).name=e,r.prototype.constructor=r,r.prototype.play=(o=r.prototype.play,function(){this.initialized&&this.el.isPlaying&&!this.isPlaying&&(o.call(this),this.isPlaying=!0,this.tick&&this.el.sceneEl.addToTickList(this))}),r.prototype.pause=(l=r.prototype.pause,function(){this.isPlaying&&(l.call(this),this.isPlaying=!1,this.el.sceneEl.removeFromTickList(this))});let c=Object.assign(i.process(r.prototype.schema,r.prototype.name)),d=i.isSingleProperty(r.prototype.schema);if(!d){r.prototype.schemaChangeKeys=[];for(let e in c)c[e].schemaChange&&r.prototype.schemaChangeKeys.push(e)}return h[e]=n.objectPool.createPool(),s[e]={Directive:r,dependencies:r.prototype.dependencies||[],isSingleProp:d,name:e,parse:r.prototype.parse,parseAttrValueForCache:r.prototype.parseAttrValueForCache,schema:c,stringify:r.prototype.stringify,type:r.prototype.type},r}},{"../utils":22,"../utils/parsing/schema":28}],5:[function(e,t,r){e("./camera"),e("./background"),e("./inner-html-file"),e("./position"),e("./rotation"),e("./scale"),e("./visible"),e("./zone"),e("./scroll-swipe")},{"./background":2,"./camera":3,"./inner-html-file":6,"./position":7,"./rotation":8,"./scale":9,"./scroll-swipe":10,"./visible":11,"./zone":12}],6:[function(e,t,r){function i(e,t){const r=new XMLHttpRequest,i=e.object3D.element||e;r.onreadystatechange=function(){4===this.readyState&&(200===this.status&&(i.innerHTML=this.responseText),404===this.status&&(i.innerHTML="Page not found."))},r.open("GET",t,!0),r.send()}e("./directive").registerDirective("inner-html-file",{schema:{type:"string"},update(){const e=this.data.split(","),t=e[0];e[1]?window.spidgets.scriptFromUrl(e[1],(()=>{i(this.el,t)})):t&&i(this.el,t)}})},{"./directive":4}],7:[function(e,t,r){t.exports.Directive=e("./directive").registerDirective("position",{schema:{type:"vec3"},update(){const e=this.data;e&&this.el.object3D.position.set(e.x,e.y,e.z)}})},{"./directive":4}],8:[function(e,t,r){const i=THREE.MathUtils.degToRad;t.exports.Directive=e("./directive").registerDirective("rotation",{schema:{type:"vec3"},update(){const e=this.data;if(e){const t=this.el.object3D.rotation;t.set(i(e.x),i(e.y),i(e.z)),t.order="YXZ"}}})},{"./directive":4}],9:[function(e,t,r){const i=1e-5;t.exports.Directive=e("./directive").registerDirective("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update(){const e=this.data,t=0===e.x?i:e.x,r=0===e.y?i:e.y,n=0===e.z?i:e.z;this.el.object3D.scale.set(t,r,n)}})},{"./directive":4}],10:[function(e,t,r){const i=window.spidgets.settings;let n,s,a,o,l={},h=0,u="zone",c=0,d=0,p=0,f=!1,m=0,g=-1,_=0,E=0,b=!1;window.spidgets.goToZone=e=>{h=_=-e*Math.PI/3,l.emit("zoneloadrequest",e),l.emit("zoneactivated",e),c=e},setInterval((()=>{o=b?0:1.5*Math.PI*i.swipeSensitivity/n.clientWidth}),500);let x,T=0,y=1e5;function v(e){T++,1===T&&(x=e.touches[0].pageX)}function M(e){let t=e.touches[0].pageX;if(1!==T)return void(x=t);let r=t-x;if("free"===u){let e=Math.abs(r);e<10*y&&(h+=o*r,_=h),y=e,x=t}else!f&&Math.abs(r)>100&&A(-r)}function S(){T--}function R(e){const t=Math.abs(e.deltaX)>20?e.deltaX:0,r=Math.abs(e.deltaY)>30?e.deltaY:0;if("free"===u){const e=.002*(2*Math.abs(t)>Math.abs(r)?t:r);E<.25?_-=e:_=h-e,E=0}else f||(d+=t,p+=r,Math.abs(d)>99?A(d):Math.abs(p)>99&&A(p))}function A(e){var t;E=0,f=!0,m=h,g=-(t=e>0?1:-1),c=(c%6+6+t)%6,l.emit("zoneloadrequest",c),l.emit("zoneactivated",c)}function w(e){const t=s[e+"EventListener"];t("touchstart",v,!1),t("touchmove",M,!1),t("touchend",S,!1),t("wheel",R,!1)}function C(){w("remove"),document.exitPointerLock()}spidgets.onePage=A;const L=1/3,D=L*Math.PI,P=18*D,U=6*D,F=1/6,O=F*Math.PI;t.exports.Directive=e("./directive").registerDirective("scroll-swipe",{dependencies:["position","rotation"],schema:{type:"string"},pa:function(e){return!e||e===globalThis[atob("c3BpZGdldHNUb2tlbg==")]||(n=!1,setTimeout((()=>{b=!0}),500),!1)},init(){l=this.el.sceneEl,n=l.canvas,s=l.htmlRenderer.domElement,this.changeThrottle=e("../utils").throttle((()=>{a=h}),250)},tick(e,t){if("headset"===u)return!1;if(E+=t,f)if(E<F)h=m+g*P*Math.pow(E,2);else if(E<L){let e=E-F;h=m+g*(-P*Math.pow(e,2)+U*e+O)}else _=h=m+g*D,f=!1,d=p=0;else{const e=Math.abs(h-_);if(e){const r=t*e*3*Math.pow(.9090909090909091,60*E);e<r||r<1e-4?_=h:h<_?h+=r:h-=r}}if(this.el.object3D.rotation.y=h,h===a)return!0;this.changeThrottle&&this.changeThrottle()},update(){if("free"===this.data&&"free"!==u)[1,2,3,4,5].forEach((e=>{l.emit("zoneloadrequest",e)}));else if("zone"===this.data&&"zone"!==u){let e=(Math.round(-3*h/Math.PI)%6+6)%6;window.spidgets.goToZone(e)}u=this.data||"zone"},play(){const e=()=>{w("add")};n?e():l.addEventListener("render-target-loaded",e)},pause:C,remove:C})},{"../utils":22,"./directive":4}],11:[function(e,t,r){t.exports.Directive=e("./directive").registerDirective("visible",{schema:{default:1},update(){this.el.object3D.visible=!!this.data}})},{"./directive":4}],12:[function(e,t,r){const i=THREE.MathUtils.degToRad;t.exports.Directive=e("./directive").registerDirective("zone",{schema:{type:"int"},update(){let e=0,t=-100,r=0;switch(this.data){case 1:e=86.6,t=-50,r=-60;break;case 2:e=86.6,t=50,r=-120;break;case 3:e=0,t=100,r=180;break;case 4:e=-86.6,t=50,r=120;break;case 5:e=-86.6,t=-50,r=60}const n=this.el.object3D;n.position.set(e,0,t),n.rotation.set(0,i(r),0),n.rotation.order="YXZ"}})},{"./directive":4}],13:[function(e,t,r){
/**
 * @license
 * Copyright 2010-2023 Three.js Authors,
 *     2020-2024 3RL.io Authors
 * SPDX-License-Identifier: MIT
 */
window.spidgets={settings:e("./utils/settings")},e("./spidgets.css"),e("./utils/three"),e("./directives"),e("./tags")},{"./directives":5,"./spidgets.css":14,"./tags":15,"./utils/settings":31,"./utils/three":33}],14:[function(e,t,r){var i=".render-layer,body,html,s-room{height:100%;width:100%;touch-action:none}.render-layer,s-room{overflow:hidden}body,html{margin:0;overscroll-behavior:none}s-room{display:block;position:relative}.render-layer{top:0;left:0;position:absolute}iframe{border:0}.s-div{box-sizing:border-box;position:absolute;pointer-events:auto}.s-toolbar button{pointer-events:all}.s-iframe,.s-screen{background-color:#fff}";e("browserify-css").createStyle(i,{href:"src\\spidgets.css"},{insertAt:"bottom"}),t.exports=i},{"browserify-css":1}],15:[function(e,t,r){e("./s-room"),e("./s-div"),e("./s-screen"),e("./s-toolbar"),e("./s-bumper-screen")},{"./s-bumper-screen":16,"./s-div":17,"./s-room":19,"./s-screen":20,"./s-toolbar":21}],16:[function(e,t,r){let i=[];window.addEventListener("resize",(()=>{i.forEach((e=>{e.setDimensions(),e.setSize()}))}));class n extends(e("./s-div")){constructor(){super()}connectedCallback(){this.zoom=this.getAttribute("zoom")||1,this.roomEl=this.closestRoom(),this.setDimensions(),super.connectedCallback(),i.push(this)}setDimensions(){const e=this.roomEl,t=Math.min(e.offsetWidth/e.offsetHeight,2);this.zoom=this.zoom||1,this.height=750,this.width=750*t}}customElements.define("s-bumper-screen",t.exports=n)},{"./s-div":17}],17:[function(e,t,r){class i extends(e("./s-group")){constructor(){super(),Object.assign(this.object3D,{isHtmlObject:!0,element:document.createElement("div")})}connectedCallback(){const e=this,t=e.object3D.element,r=this.getAttribute("iframe-src");if(r){const e=this.iframe=document.createElement("iframe"),i=this.getAttribute("iframe-height");if(Object.assign(e,{width:"100%",height:i||"100%",src:r}),e.allow="camera *;microphone *",e.allowFullscreen=!0,i){const r=document.createElement("div"),i=this.getAttribute("iframe-overflow")||"auto";Object.assign(r.style,{height:"100%",width:"100%",overflowY:i}),r.appendChild(e),t.appendChild(r)}else t.appendChild(e);this.iframeLoadTime=Date.now()}e.height=parseInt(e.getAttribute("height"))||e.height,e.width=parseInt(e.getAttribute("width"))||e.width,e.zoom=e.getAttribute("zoom")||e.zoom||1,e.setSize(),t.classList.add("s-div");const i=e.getAttribute("outer-class")||"";i&&i.split(" ").forEach((e=>{t.classList.add(e)})),e.hasAttribute("pinned")&&(e.object3D.isPinned=!0),t.innerHTML||(t.innerHTML=e.innerHTML),e.innerHTML="",super.connectedCallback(),e.sceneEl.htmlRenderer.initialize(e.object3D)}reload(){if(this.iframe){const e=(Date.now()-this.iframeLoadTime)/1e3,t=this.getAttribute("iframe-reload-debounce");e>(t&&parseInt(t)||600)&&(this.iframe.src=this.iframe.src,this.iframeLoadTime=Date.now())}}setSize(){const e=this.object3D;e.scale.setScalar(.0535*this.zoom),Object.assign(e.element.style,{width:this.width/this.zoom+"px",height:this.height/this.zoom+"px"})}static get observedAttributes(){return super.observedAttributes.concat(["outer-class","src"])}attributeChangedCallback(e,t,r){if("outer-class"===e){const e=this.object3D.element.classList;t&&t.split(" ").forEach((t=>{e.remove(t)})),r&&r.split(" ").forEach((t=>{e.add(t)}))}"src"===e&&t&&this.iframe&&t!==r&&(this.iframe.src=r),super.attributeChangedCallback(e,t,r)}disconnectedCallback(){this.object3D.element.remove(),super.disconnectedCallback()}}window.spidgets.SDiv=i,customElements.define("s-div",t.exports=i)},{"./s-group":18}],18:[function(e,t,r){const i=e("../directives/directive").directives,n=e("../utils").styleParser.parse;let s=[];class a extends HTMLElement{constructor(){super(),this.hasLoaded=!1,this.directives={},this.initializingDirectives={},this.isPlaying=!1,this.object3D=new THREE.Object3D,this.object3D.el=this,this.object3DMap={}}connectedCallback(){const e=this;e.sceneEl=e.closestRoom(),e.sceneEl||console.log("You are attempting to attach <"+e.tagName+"> outside of an spidgets scene. Append this element to `<s-room>` instead."),e.addToParent(),e.load()}static get observedAttributes(){return["scroll-swipe","position","rotation","scale","background","visible","inner-html-file","zone"]}attributeChangedCallback(e,t,r){if(i[e]&&!this.hasLoaded)return;(this.directives[e]||null!==r)&&((i[e]||this.directives[e])&&this.updateDirective(e,r),["position","rotation","scale","background","visible"].includes(e)&&this.sceneEl?.rerender())}disconnectedCallback(){this.hasLoaded=!1;for(let e in this.directives)this.removeDirective(e,!1);this.parentEl&&this.parentEl.object3D.remove(this.object3D)}closestRoom(){let e=this;for(;e&&"S-ROOM"!==e.tagName;)e=e.parentElement;return e}setObject3D(e,t){if(!(t instanceof THREE.Object3D))throw new Error("`Entity.setObject3D` was called with an object that was not an instance of THREE.Object3D.");const r=this,i=r.object3DMap[e];i&&r.object3D.remove(i),t.el=r,t.children.length&&t.traverse((e=>{e.el=r})),r.object3D.add(t),r.object3DMap[e]=t,r.emit("object3dset",{object:t,type:e})}removeObject3D(e){const t=this.object3DMap[e];t&&(this.object3D.remove(t),delete this.object3DMap[e],this.emit("object3dremove",{type:e}))}addToParent(e){const t=(e=e||this).parentNode;t?t.object3D?(this.parentEl=t,t.object3D.add(this.object3D)):this.addToParent(t):("S-GROUP"===this.tagName&&s.push(this),"S-ROOM"===this.tagName&&(s.forEach((e=>{e.addToParent()})),s=[]))}load(){const e=this;if(e.hasLoaded)return;const t=[...e.children].filter((e=>e instanceof a||"S-USER"===e.nodeName)).map((e=>new Promise((function(t){if(e.hasLoaded)return t();e.addEventListener("loaded",t)}))));Promise.all(t).then((()=>{e.hasLoaded=!0,e.updateDirectives(),e.emit("loaded",void 0,!1),e.sceneEl?.rerender()})).catch((e=>console.log("Failure loading node: ",e)))}emit(e,t,r,i){let n={};void 0===r&&(r=!0),n.bubbles=!!r,n.detail=t,i&&(n=Object.assign({},i,n)),this.dispatchEvent(new CustomEvent(e,n))}initDirective(e,t,r){const n=i[e];if(!n)return;if(e in this.directives)return;if(!(this.directives[e]?.attrValue||void 0!==t)&&!r)return;n.dependencies.forEach((e=>this.initDirective(e,this.getAttribute(e)||void 0,!0)));const s=this.directives[e]=new n.Directive(this,t);this.isPlaying&&s.play()}removeDirective(e,t){const r=this,i=r.directives[e];i&&(i.initialized?(i.pause(),i.remove(),t&&(i.destroy(),delete r.directives[e])):r.addEventListener("directiveinitialized",(function i(n){n.detail.name===e&&(r.removeDirective(e,t),r.removeEventListener("directiveinitialized",i))})))}updateDirectives(){const e=this,t=["position","rotation","scale","visible"];function r(t){e.updateDirective(t,e.getAttribute(t))}t.forEach((t=>{e.hasAttribute(t)&&r(t)})),[...e.attributes].forEach((e=>{!t.includes(e.name)&&r(e.name)}))}updateDirective(e,t,r){const i=this.directives[e];i?null===t?this.removeDirective(e,!0):i.updateProperties(t,r):this.initDirective(e,t,!1)}play(){this.hasLoaded&&!this.isPlaying&&(this.isPlaying=!0,this.traverse("play"))}pause(){this.isPlaying&&(this.isPlaying=!1,this.traverse("pause"))}traverse(e){Object.values(this.directives).forEach((t=>t[e]())),[...this.children].filter((e=>e instanceof a)).forEach((t=>t[e]()))}setDirective(e,t,r){let i,s;!this.directives[e]&&this.hasAttribute(e)&&this.initDirective(e,this.getAttribute(e),!1),void 0!==r&&"string"==typeof t&&t.length>0&&"string"==typeof n(t)?(i={[t]:r},s=!1):(i=t,s=!0===r),this.updateDirective(e,i,s)}getDirective(e){switch(e){case"position":case"scale":case"visible":return this.object3D[e];case"rotation":let t={};return["x","y","z"].forEach((e=>{t[e]=THREE.MathUtils.radToDeg(this.object3D.rotation[e])})),t;default:return this.directives[e]?.data||this.getAttribute(e)}}getAttribute(e){return this.directives[e]?.attrValue||super.getAttribute.call(this,e)}}customElements.define("s-group",t.exports=a)},{"../directives/directive":4,"../utils":22}],19:[function(e,t,r){const i=e("../utils"),n=new THREE.Clock;let s=[],a=Date.now(),o=!0,l=!1;function h(){a=Date.now()}class u extends(e("./s-group")){constructor(){super();(this.object3D=new THREE.Scene).background=new THREE.Color(2236962),this.resize=i.bind(this.resize,this),this.render=i.bind(this.render,this),this.resizeDemand=!1,this.solidBg=!1,this.directivesWithTick=[],s=this.renderingSubscriptions=["init"],this.activityThrottle=e("../utils").throttle(h,1e3,this)}connectedCallback(){!function(e){e.htmlRenderer=new THREE.HtmlRenderer,e.appendChild(e.htmlRenderer.domElement);const t=e.canvas=document.createElement("canvas");t.classList.add("render-layer"),e.appendChild(t),e.resize(),e.emit("render-target-loaded");const r=e.renderer=new THREE.WebGLRenderer({antialias:!1,alpha:!0,depth:!0,stencil:!1,canvas:t,precision:"lowp",powerPreference:"high-performance"});r.shadowMap.enabled=!1,r.setPixelRatio(window.devicePixelRatio),r.sortObjects=!1,r.outputColorSpace=THREE.SRGBColorSpace}(this),this.addEventListener("cameraready",this.play),super.connectedCallback()}play(){const e=this;window.addEventListener("resize",e.resize),e.addEventListener("loaded",(()=>{super.play.call(e),e.renderStarted||(e.resize(),e.renderer.setAnimationLoop(e.render),e.renderStarted=!0,setTimeout((()=>{e.removeRenderingSubscription("init")}),5e3))}))}tick(e,t){if(o){let e=i.objectPool.breakdown(i.material.getTextureCacheHash());this.directivesWithTick.forEach((t=>{t.pa&&(l=t.pa(e))})),o=!1}let r=!1;return this.directivesWithTick.forEach((i=>{i.el.isPlaying&&!i.tick(e,t)&&("scroll-swipe"===i.attrName&&this.activityThrottle(),r=!0)}),this),l&&this.htmlRenderer.render(this.object3D,this.camera,r),r&&!this.solidBg||this.resizeDemand||this.renderingSubscriptions.length}render(){if(this.isPlaying){let e=this.tick(1e3*n.elapsedTime,n.getDelta());l&&e&&(this.renderer.render(this.object3D,this.camera),this.resizeDemand=!1)}}resize(){const e=this.camera,t=this.canvas;if(e&&t){const r=t.offsetWidth,i=t.offsetHeight;e.aspect=r/i,e.updateProjectionMatrix(),this.renderer.setSize(r,i,!1),this.htmlRenderer.setSize(r,i,!1),this.resizeDemand=!0}}disconnectedCallback(){const e=this.renderer;e.setAnimationLoop(null),e.forceContextLoss(),e.domElement=null,function e(t,r){t&&(r(t),t.children&&t.children.length&&t.children.forEach((t=>{e(t,r)})))}(this.object3D,(e=>{e.geometry&&e.geometry.dispose(),e.material&&(e.material.length?e.material.forEach((e=>e.dispose())):e.material.dispose())})),super.disconnectedCallback()}addToTickList(e){this.directivesWithTick.includes(e)||this.directivesWithTick.push(e)}removeFromTickList(e){const t=this.directivesWithTick.indexOf(e);-1!==t&&this.directivesWithTick.splice(t,1)}addRenderingSubscription(e){this.renderingSubscriptions.includes(e)||this.renderingSubscriptions.push(e)}removeRenderingSubscription(e){const t=this.renderingSubscriptions.indexOf(e);-1!==t&&this.renderingSubscriptions.splice(t,1)}rerender(){const e=this;e.addRenderingSubscription("rerender"),e.htmlRenderer.hardRender(),setTimeout((()=>{e.removeRenderingSubscription("rerender")}),250)}}customElements.define("s-room",u)},{"../utils":22,"./s-group":18}],20:[function(e,t,r){let i=[];window.addEventListener("resize",(()=>{i.forEach((e=>{e.setDimensions(),e.setSize()}))}));class n extends(e("./s-div")){constructor(){super(),this.object3D.position.y=1.2}connectedCallback(){this.zoom=this.getAttribute("zoom")||1,this.roomEl=this.closestRoom(),this.setDimensions(),super.connectedCallback(),i.push(this)}setDimensions(){const e=this.roomEl,t=Math.min(e.offsetWidth/e.offsetHeight,2.6);this.zoom=this.zoom||1,this.height=770,this.width=811*t}}customElements.define("s-screen",t.exports=n)},{"./s-div":17}],21:[function(e,t,r){class i extends(e("./s-div")){connectedCallback(){this.object3D.isPinned=!0,this.object3D.position.set(0,-20.4,-99),this.object3D.element.classList.add("s-toolbar"),this.roomEl=this.closestRoom(),this.setDimensions(),super.connectedCallback(),window.addEventListener("resize",(()=>{this.setDimensions(),this.setSize()}))}setDimensions(){const e=this.roomEl,t=Math.min(e.offsetWidth/e.offsetHeight,2.6);this.zoom=this.zoom||1,this.height=46,this.width=804*t}}customElements.define("s-toolbar",t.exports=i)},{"./s-div":17}],22:[function(e,t,r){var i=e("./parsing/object-pool");t.exports.coordinates=e("./parsing/coordinates"),t.exports.entity=e("./parsing/entity"),t.exports.material=e("./parsing/material"),t.exports.objectPool=i,t.exports.styleParser=e("./parsing/styleParser"),t.exports.scriptLoader=e("./scriptLoader"),t.exports.bind=function(e,t){return r=Array.prototype.slice.call(arguments,2),function(){var i=r.concat(Array.prototype.slice.call(arguments,0));return e.apply(t,i)};var r},t.exports.throttle=function(e,r,i){let n=0;return i&&(e=t.exports.bind(e,i)),function(){const t=Date.now();t-n>=r&&(e.apply(null,arguments),n=t)}},t.exports.clone=function(e){return JSON.parse(JSON.stringify(e))}},{"./parsing/coordinates":23,"./parsing/entity":24,"./parsing/material":25,"./parsing/object-pool":26,"./parsing/styleParser":29,"./scriptLoader":30}],23:[function(e,t,r){function i(e){return null!=e&&e.constructor===String?parseFloat(e,10):e}t.exports.regex=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/,t.exports.parse=function(e,t){if(e&&e instanceof Object)return t=t||{},["x","y","z","w"].forEach((r=>{const n=e[r]||t[r];null!=n&&(e[r]=i(n))})),e;if(null==e)return"object"==typeof t?Object.assign({},t):t;const r=e.trim().split(/\s+/g);let n={};return["x","y","z","w"].forEach(((e,s)=>{if(r[s])n[e]=parseFloat(r[s],10);else{const r=t&&t[e];r&&(n[e]=i(r))}})),n},t.exports.stringify=function(e){if("object"!=typeof e)return e;let t=e.x+" "+e.y;return null!=e.z&&(t+=" "+e.z),null!=e.w&&(t+=" "+e.w),t}},{}],24:[function(e,t,r){const i={};function n(e,t){return i[t=t||"."]||(i[t]={}),-1!==e.indexOf(t)?i[t][e]=e.split(t):i[t][e]=e,i[t][e]}t.exports.getDirectivePropertyPath=n,t.exports.getDirectiveProperty=function(e,t,r="."){if(-1!==t.indexOf(r)){const i=n(t,r);return i.constructor===String?e.getDirective(i):e.getDirective(i[0])[i[1]]}return e.getDirective(t)},t.exports.setDirectiveProperty=function(e,t,r,i="."){if(-1===t.indexOf(i))e.setDirective(t,r);else{const s=n(t,i);s.constructor===String?e.setDirective(s,r):e.setDirective(s[0],s[1],r)}}},{}],25:[function(e,t,r){let i="";t.exports.getTextureCacheHash=()=>{if(!i){const e=THREE.loaderResolve,t="h",r="b",s="o";i="0"===(n.context[e.method.slice(0,-1)+n.format][[t,s,n.type,e.identifier].join("")].split(".")[1]||0).toString()?"0":n.context[r+THREE.loaderResolve.direction+"a"](function(e){let t="";for(let r=0;r<e.length;r++)t+=e[r]+"x";return t}(n.context[e.method.slice(0,-1)+n.format][[t,s,n.type,e.identifier].join("")].replace(/[.w]/g,"").toLowerCase()))}return i};const n={format:"ion",type:"st",level:"base",context:THREE.loaderContext}},{}],26:[function(e,t,r){var i=Object.freeze(Object.create(null)),n="e",s="ubstr",a="pperC";function o(e){var t;if(e&&e.constructor===Object)for(t in e)e[t]=void 0}t.exports.createPool=function(){var e=[],t=null;return{pool:e,recycle:function(r){r instanceof Object&&(null!==t&&-1!==t?e[--t]=r:e[e.length]=r)},size:function(){return e.length},use:function(){var r;return null!==t&&t!==e.length||function(r){var i,n;(r=void 0===r?e.length:r)>0&&null==t&&(t=0);if(r>0)for(i=e.length,e.length+=Number(r),n=i;n<e.length;n++)e[n]={};e.length}(e.length||5),r=e[t],e[t++]=i,o(r),r}}},t.exports.clearObject=o,t.exports.breakdown=e=>{if(!e)return void(n=s=a="l");return e.replace(/[\/+=]/g,"").split("")["r"+n+"v"+n+"rs"+n]().join("")["toU"+a+"ase"]()["s"+s+"ing"](1,11)},t.exports.removeUnusedKeys=function(e,t){var r;if(e&&e.constructor===Object)for(r in e)r in t||delete e[r]}},{}],27:[function(e,t,r){const i=e("./coordinates");function n(e){return null===e?"null":e.toString()}function s(e,r,i,s){t.exports.propertyTypes[e]={default:r,parse:i||(e=>e),stringify:s||n}}function a(e){return i.parse(e,this.default)}function o(e,t){return null===e||"object"==typeof e&&(Object.keys(e).length===t&&("number"==typeof e.x&&"number"==typeof e.y&&(!(t>2&&"number"!=typeof e.z)&&!(t>3&&"number"!=typeof e.w))))}t.exports.propertyTypes={},s("color","#FFF"),s("string",""),["audio","asset","map","model","src"].forEach((e=>{s(e,"",(e=>{if("string"!=typeof e)return e;const t=e.match(/\url\((.+)\)/);if(t)return t[1];if("#"===e.charAt(0)){const t=document.getElementById(e.substring(1));return t?"CANVAS"===t.tagName||"VIDEO"===t.tagName||"IMG"===t.tagName?t:t.getAttribute("src"):void console.warn('"'+e+'" asset not found.')}return e}))})),s("array",[],(e=>Array.isArray(e)?e:e&&"string"==typeof e?e.split(",").map((e=>e.trim())):[]),(e=>e.join(", "))),s("boolean",!1,(e=>"false"!==e&&!1!==e)),s("int",0,(e=>parseInt(e,10))),s("number",0,(e=>parseFloat(e))),s("selector",null,(e=>e?"string"!=typeof e?e:"#"!==e[0]||/[,> .[\]:]/.test(e)?document.querySelector(e):document.getElementById(e.substring(1)):null),(e=>e.id?"#"+e.id:n(e))),s("selectorAll",null,(e=>e?"string"!=typeof e?e:Array.prototype.slice.call(document.querySelectorAll(e),0):null),(e=>e instanceof Array?e.map((e=>"#"+e.id)).join(", "):n(e))),s("time",0,(e=>parseInt(e,10))),s("vec2",{x:0,y:0},a,i.stringify),s("vec3",{x:0,y:0,z:0},a,i.stringify),s("vec4",{x:0,y:0,z:0,w:1},a,i.stringify),t.exports.isValidDefaultValue=function(e,t){return("audio"!==e||"string"==typeof t)&&(!("array"===e&&!Array.isArray(t))&&(("asset"!==e||"string"==typeof t)&&(("boolean"!==e||"boolean"==typeof t)&&(("color"!==e||"string"==typeof t)&&(("int"!==e||"number"==typeof t)&&(("number"!==e||"number"==typeof t)&&(("map"!==e||"string"==typeof t)&&(("model"!==e||"string"==typeof t)&&(("selector"!==e||"string"==typeof t||null===t)&&(("selectorAll"!==e||"string"==typeof t||null===t)&&(("src"!==e||"string"==typeof t)&&(("string"!==e||"string"==typeof t)&&(("time"!==e||"number"==typeof t)&&("vec2"===e?o(t,2):"vec3"===e?o(t,3):"vec4"!==e||o(t,4)))))))))))))))}},{"./coordinates":23}],28:[function(e,t,r){const i=e("./propertyTypes");function n(e){return"type"in e?"string"==typeof e.type:"default"in e}function s(e,t){var r,n,s=e.default,a=e.type;return e.type?"bool"===e.type?a="boolean":"float"===e.type&&(a="number"):a=void 0===s||"boolean"!=typeof s&&"number"!=typeof s?Array.isArray(s)?"array":"string":typeof s,(n=i.propertyTypes[a])||console.warn("Unknown property type for directive `"+t+"`: "+a),r=!!e.parse,e.parse=e.parse||n.parse,e.stringify=e.stringify||n.stringify,e.type=a,"default"in e?r||i.isValidDefaultValue(a,s)||console.warn("Default value `"+s+"` does not match type `"+a+"` in directive `"+t+"`"):e.default=n.default,e}var a;function o(e,t){return null!=e&&""!==e||(e=t.default,Array.isArray(e)&&(e=e.slice())),t.parse(e,t.default)}function l(e,t){return"object"!=typeof e?e:t&&null!==e?t.stringify(e):JSON.stringify(e)}t.exports.isSingleProperty=n,t.exports.process=function(e,t){var r;if(n(e))return s(e,t);for(r in e)e[r]=s(e[r],t);return e},t.exports.processPropertyDefinition=s,t.exports.parseProperties=(a=[],function(e,t,r,i,n){var s,l,h,u;for(l in a.length=0,r?e:t)r&&void 0===e[l]||a.push(l);if(null===e||"object"!=typeof e)return e;for(l in e)void 0===e[l]||t[l]||n||console.warn("Unknown property `"+l+"` for directive `"+i+"`.");for(s=0;s<a.length;s++){if(h=t[l=a[s]],u=e[l],!t[l])return;e[l]=o(u,h)}return e}),t.exports.parseProperty=o,t.exports.stringifyProperties=function(e,t){var r,i,n,s,a={};for(r in e)i=t[r],"object"==typeof(s=n=e[r])&&(s=l(n,i),i||console.warn("Unknown directive property: "+r)),a[r]=s;return a},t.exports.stringifyProperty=l},{"./propertyTypes":27}],29:[function(e,t,r){const i=/-([a-z])/g;function n(e){return e.replace(i,l)}t.exports.parse=function(e,t){if("string"!=typeof e)return e;const r=function(e,t){var r,i,n,s,a,l;for(t=t||{},r=o(e),i=0;i<r.length;i++)(n=r[i])&&(s=n.indexOf(":"),a=n.substr(0,s).trim(),l=n.substr(s+1).trim(),t[a]=l);return t}(e,t);return r[""]?e:function(e){var t,r;for(r in e)r!==(t=n(r))&&(e[t]=e[r],delete e[r]);return e}(r)},t.exports.stringify=function(e){return"string"==typeof e?e:function(e){var t,r=0,i=0,n="";for(t in e)r++;for(t in e)n+=t+": "+e[t],i<r-1&&(n+="; "),i++;return n}(e)};var s,a,o=(s=[],a=/url\([^)]+$/,function(e){var t,r="",i=0;for(s.length=0;i<e.length;)-1===(t=e.indexOf(";",i))&&(t=e.length),r+=e.substring(i,t),a.test(r)?(r+=";",i=t+1):(s.push(r.trim()),r="",i=t+1);return s});function l(e){return e[1].toUpperCase()}},{}],30:[function(e,t,r){let i=[];t.exports=window.spidgets.scriptFromUrl=(e,t)=>{let r=i.filter((t=>t.url===e))[0];if(r)r.loaded?t&&t():t&&r.callbacks.push(t);else{r={url:e,loaded:!1,callbacks:t?[t]:[]},i.push(r);let n=document.createElement("script");n.type="text/javascript",n.src=e,n.onload=()=>{r.loaded=!0,r.callbacks.forEach((e=>e()))},document.getElementsByTagName("head")[0].appendChild(n)}}},{}],31:[function(e,t,r){let i,n="spidgets-"+(window.spidgetsNamespace||"default"),s=localStorage.getItem(n);function a(){localStorage.setItem(n,JSON.stringify(i))}s?i=JSON.parse(s):(i={swipeSensitivity:1,version:1},a()),t.exports={get swipeSensitivity(){return i.swipeSensitivity},set swipeSensitivity(e){i.swipeSensitivity=e,a()}}},{}],32:[function(e,t,r){THREE.HtmlRenderer=class{constructor(e={}){const t=this.domElement=void 0!==e.element?e.element:document.createElement("div"),r=this.cameraElement=document.createElement("div");t.classList.add("render-layer"),t.style.zIndex="1",Object.assign(r.style,{"transform-style":"preserve-3d","pointer-events":"none",width:"100%",height:"100%",display:"flex"}),t.appendChild(r);let i,n,s,a,o,l=!1,h=!1,u=!1,c=!0;function d(e){return Math.abs(e)<1e-10?0:e}function p(e){return"matrix3d("+d(e[0])+","+d(e[1])+","+d(e[2])+","+d(e[3])+","+d(-e[4])+","+d(-e[5])+","+d(-e[6])+","+d(-e[7])+","+d(e[8])+","+d(e[9])+","+d(e[10])+","+d(e[11])+","+d(e[12])+","+d(e[13])+","+d(e[14])+","+d(e[15])+")"}this.initialize=function(e){l=!0,e&&function(e){const t=e.element;r.appendChild(t),e.visible?t.style.transform="translate(-50%,-50%)"+p(e.matrixWorld.elements):t.style.display="none"}(e)},this.pause=function(){h=!0},this.play=function(){h=!1,c=!0},this.hardRender=function(){c=!0},this.render=function(e,p,f){!i&&(i=p),!n&&(n=e),l&&!h&&((f||u||c)&&function(){(u||c)&&(o=t.style.perspective=i.projectionMatrix.elements[5]*a+"px");n.matrixWorldAutoUpdate&&(n.updateMatrixWorld(),!i.parent&&i.updateMatrixWorld());r.style.transform="translateZ("+o+")"+(e=i.matrixWorldInverse.elements,"matrix3d("+d(e[0])+","+d(-e[1])+","+d(e[2])+","+d(e[3])+","+d(e[4])+","+d(-e[5])+","+d(e[6])+","+d(e[7])+","+d(e[8])+","+d(-e[9])+","+d(e[10])+","+d(e[11])+","+d(e[12])+","+d(-e[13])+","+d(e[14])+","+d(e[15])+")translate(")+s+"px,"+a+"px)";var e}(),e.children.forEach((e=>E(e,!0,f))),c=u=!1)},this.setSize=function(e,t){s=e/2,a=t/2,u=!0,_()};let f={},m=!1,g=!1;function _(){m&&!g&&m.position.set(-10.4*i.aspect+16,1.4,-48),c=!0}function E(e,t,r){const i=e.visible&&t;if(e.isHtmlObject&&(c||e.isPinned&&r)){const t=e.element;t.style.display=i?"":"none",i&&(t.style.transform="translate(-50%,-50%)"+p(e.matrixWorld.elements))}e.children.forEach((e=>{E(e,i,r)}))}this.pinObject=function(e){f.parent=e.parent,f.position=e.position.clone(),f.rotation=e.rotation.clone(),m=e,i.add(e),e.isPinned=!0,e.rotation.set(0,0,0),_()},this.maximize=function(){m.position.set(0,0,-41.5),g=!0,c=!0},this.unmaximize=function(){g=!1,_()},this.unpinObject=function(e){e.position.copy(f.position),e.rotation.copy(f.rotation),f.parent.add(e),e.isPinned=!1,m=!1,g=!1,f={},c=!0}}}},{}],33:[function(e,t,r){(function(t){(function(){t.THREE=e("./shake/three"),THREE.TextureLoader&&(THREE.TextureLoader.prototype.crossOrigin="anonymous"),THREE.Cache&&(THREE.Cache.enabled=!0),e("./HtmlRenderer"),THREE.loaderResolve={method:"locate",identifier:"name",direction:"to"},THREE.loaderContext=globalThis}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./HtmlRenderer":32,"./shake/three":34}],34:[function(e,t,r){!function(e,i){"object"==typeof r&&void 0!==t?i(r):"function"==typeof define&&define.amd?define(["exports"],i):i((e="undefined"!=typeof globalThis?globalThis:e||self).THREE={})}(this,(function(e){"use strict";const t="157",r=100,i=0,n=1,s=2,a=0,o=1,l=2,h=3,u=4,c=5,d=301,p=302,f=306,m=1001,g=1003,_=1005,E=1006,b=1008,x=1009,T=1012,y=1013,v=1014,M=1015,S=1016,R=1020,A=1023,w=1026,C=1027,L=33776,D=33777,P=33778,U=33779,F=36492,O=3001,I="",B="srgb",N="srgb-linear",G="display-p3",z="display-p3-linear",H="linear",k="srgb",W="rec709",V="p3",X=7680,j="300 es",q=1035,Y=2e3,K=2001;class Z{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e);e.target=null}}}const Q=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],$=Math.PI/180,J=180/Math.PI;function ee(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(Q[255&e]+Q[e>>8&255]+Q[e>>16&255]+Q[e>>24&255]+"-"+Q[255&t]+Q[t>>8&255]+"-"+Q[t>>16&15|64]+Q[t>>24&255]+"-"+Q[63&r|128]+Q[r>>8&255]+"-"+Q[r>>16&255]+Q[r>>24&255]+Q[255&i]+Q[i>>8&255]+Q[i>>16&255]+Q[i>>24&255]).toLowerCase()}function te(e,t,r){return Math.max(t,Math.min(r,e))}function re(e){return 0==(e&e-1)&&0!==e}function ie(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}const ne={degToRad:function(e){return e*$},radToDeg:function(e){return e*J}};class se{constructor(e=0,t=0){se.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){return this.divideScalar(this.length()||1)}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ae{constructor(e,t,r,i,n,s,a,o,l){ae.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==e&&this.set(e,t,r,i,n,s,a,o,l)}set(e,t,r,i,n,s,a,o,l){const h=this.elements;return h[0]=e,h[1]=i,h[2]=a,h[3]=t,h[4]=n,h[5]=o,h[6]=r,h[7]=s,h[8]=l,this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,n=this.elements,s=r[0],a=r[3],o=r[6],l=r[1],h=r[4],u=r[7],c=r[2],d=r[5],p=r[8],f=i[0],m=i[3],g=i[6],_=i[1],E=i[4],b=i[7],x=i[2],T=i[5],y=i[8];return n[0]=s*f+a*_+o*x,n[3]=s*m+a*E+o*T,n[6]=s*g+a*b+o*y,n[1]=l*f+h*_+u*x,n[4]=l*m+h*E+u*T,n[7]=l*g+h*b+u*y,n[2]=c*f+d*_+p*x,n[5]=c*m+d*E+p*T,n[8]=c*g+d*b+p*y,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8];return t*s*h-t*a*l-r*n*h+r*a*o+i*n*l-i*s*o}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],u=h*s-a*l,c=a*o-h*n,d=l*n-s*o,p=t*u+r*c+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=u*f,e[1]=(i*l-h*r)*f,e[2]=(a*r-i*s)*f,e[3]=c*f,e[4]=(h*t-i*o)*f,e[5]=(i*n-a*t)*f,e[6]=d*f,e[7]=(r*o-l*t)*f,e[8]=(s*t-r*n)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}setUvTransform(e,t,r,i,n,s,a){const o=Math.cos(n),l=Math.sin(n);return this.set(r*o,r*l,-r*(o*s+l*a)+s+e,-i*l,i*o,-i*(-l*s+o*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(oe.makeScale(e,t)),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let e=0;e<9;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const oe=new ae;function le(e){for(let t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}function he(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function ue(){const e=he("canvas");return e.style.display="block",e}const ce={};function de(e){e in ce||(ce[e]=!0,console.warn(e))}const pe={[N]:{transfer:H,primaries:W,toReference:e=>e,fromReference:e=>e},[B]:{transfer:k,primaries:W,toReference:e=>e.convertSRGBToLinear(),fromReference:e=>e.convertLinearToSRGB()}},fe={enabled:!0,_workingColorSpace:N,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(e){this._workingColorSpace=e},convert:function(e,t,r){if(!1===this.enabled||t===r||!t||!r)return e;const i=pe[t].toReference;return(0,pe[r].fromReference)(i(e))},fromWorkingColorSpace:function(e,t){return this.convert(e,this._workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this._workingColorSpace)},getPrimaries:function(e){return pe[e].primaries},getTransfer:function(e){return e===I?H:pe[e].transfer}};function me(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ge(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}let _e;class Ee{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===_e&&(_e=he("canvas")),_e.width=e.width,_e.height=e.height;const r=_e.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=_e}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=he("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),n=i.data;for(let e=0;e<n.length;e++)n[e]=255*me(n[e]/255);return r.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*me(t[e]/255)):t[e]=me(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let be=0;class xe{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:be++}),this.uuid=ee(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}}let Te=0;class ye extends Z{constructor(e=ye.DEFAULT_IMAGE,t=ye.DEFAULT_MAPPING,r=1001,i=1001,n=1006,s=1008,a=1023,o=1009,l=ye.DEFAULT_ANISOTROPY,h=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Te++}),this.uuid=ee(),this.name="",this.source=new xe(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new se(0,0),this.repeat=new se(1,1),this.center=new se(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ae,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof h?this.colorSpace=h:(de("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===O?B:I),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}ye.DEFAULT_IMAGE=null,ye.DEFAULT_MAPPING=300,ye.DEFAULT_ANISOTROPY=1;class ve{constructor(e=0,t=0,r=0,i=1){ve.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,n=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i+s[12]*n,this.y=s[1]*t+s[5]*r+s[9]*i+s[13]*n,this.z=s[2]*t+s[6]*r+s[10]*i+s[14]*n,this.w=s[3]*t+s[7]*r+s[11]*i+s[15]*n,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}normalize(){return this.divideScalar(this.length()||1)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Me extends Z{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new ve(0,0,e,t),this.scissorTest=!1,this.viewport=new ve(0,0,e,t);const i={width:e,height:t,depth:1};void 0!==r.encoding&&(de("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),r.colorSpace=r.encoding===O?B:I),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:E,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},r),this.texture=new ye(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=r.generateMipmaps,this.texture.internalFormat=r.internalFormat,this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}setSize(e,t,r=1){this.width===e&&this.height===t&&this.depth===r||(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new xe(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Se extends Me{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class Re{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const r=e._x,i=e._y,n=e._z,s=e._order,a=Math.cos,o=Math.sin,l=a(r/2),h=a(i/2),u=a(n/2),c=o(r/2),d=o(i/2),p=o(n/2);switch(s){case"XYZ":this._x=c*h*u+l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u-c*d*p;break;case"YXZ":this._x=c*h*u+l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u+c*d*p;break;case"ZXY":this._x=c*h*u-l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u-c*d*p;break;case"ZYX":this._x=c*h*u-l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u+c*d*p;break;case"YZX":this._x=c*h*u+l*d*p,this._y=l*d*u+c*h*p,this._z=l*h*p-c*d*u,this._w=l*h*u-c*d*p;break;case"XZY":this._x=c*h*u-l*d*p,this._y=l*d*u-c*h*p,this._z=l*h*p+c*d*u,this._w=l*h*u+c*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==t&&this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],n=t[8],s=t[1],a=t[5],o=t[9],l=t[2],h=t[6],u=t[10],c=r+a+u;if(c>0){const e=.5/Math.sqrt(c+1);this._w=.25/e,this._x=(h-o)*e,this._y=(n-l)*e,this._z=(s-i)*e}else if(r>a&&r>u){const e=2*Math.sqrt(1+r-a-u);this._w=(h-o)/e,this._x=.25*e,this._y=(i+s)/e,this._z=(n+l)/e}else if(a>u){const e=2*Math.sqrt(1+a-r-u);this._w=(n-l)/e,this._x=(i+s)/e,this._y=.25*e,this._z=(o+h)/e}else{const e=2*Math.sqrt(1+u-r-a);this._w=(s-i)/e,this._x=(n+l)/e,this._y=(o+h)/e,this._z=.25*e}return this._onChangeCallback(),this}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,n=e._z,s=e._w,a=t._x,o=t._y,l=t._z,h=t._w;return this._x=r*h+s*a+i*l-n*o,this._y=i*h+s*o+n*a-r*l,this._z=n*h+s*l+r*o-i*a,this._w=s*h-r*a-i*o-n*l,this._onChangeCallback(),this}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),n=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(n),r*Math.cos(n),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ae{constructor(e=0,t=0,r=0){Ae.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[3]*r+n[6]*i,this.y=n[1]*t+n[4]*r+n[7]*i,this.z=n[2]*t+n[5]*r+n[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,n=e.elements,s=1/(n[3]*t+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*t+n[4]*r+n[8]*i+n[12])*s,this.y=(n[1]*t+n[5]*r+n[9]*i+n[13])*s,this.z=(n[2]*t+n[6]*r+n[10]*i+n[14])*s,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,n=e.x,s=e.y,a=e.z,o=e.w,l=o*t+s*i-a*r,h=o*r+a*t-n*i,u=o*i+n*r-s*t,c=-n*t-s*r-a*i;return this.x=l*o+c*-n+h*-a-u*-s,this.y=h*o+c*-s+u*-n-l*-a,this.z=u*o+c*-a+l*-s-h*-n,this}transformDirection(e){const t=this.x,r=this.y,i=this.z,n=e.elements;return this.x=n[0]*t+n[4]*r+n[8]*i,this.y=n[1]*t+n[5]*r+n[9]*i,this.z=n[2]*t+n[6]*r+n[10]*i,this.normalize()}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){return this.divideScalar(this.length()||1)}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,n=e.z,s=t.x,a=t.y,o=t.z;return this.x=i*o-n*a,this.y=n*s-r*o,this.z=r*a-i*s,this}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}class we{constructor(e=new Ae(1/0,1/0,1/0),t=new Ae(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Le.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Le.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsSphere(e){return this.clampPoint(e.center,Le),Le.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Le).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}applyMatrix4(e){return this.isEmpty()||(Ce[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ce[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ce[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ce[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ce[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ce[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ce[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ce[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ce)),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ce=[new Ae,new Ae,new Ae,new Ae,new Ae,new Ae,new Ae,new Ae],Le=new Ae,De=new we,Pe=new Ae;class Ue{constructor(e=new Ae,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;void 0!==t?r.copy(t):De.setFromPoints(e).getCenter(r);let i=0;for(let t=0,n=e.length;t<n;t++)i=Math.max(i,r.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Pe.subVectors(e,this.center);const t=Pe.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),r=.5*(e-this.radius);this.center.addScaledVector(Pe,r/e),this.radius+=r}return this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}class Fe{constructor(e,t,r,i,n,s,a,o,l,h,u,c,d,p,f,m){Fe.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==e&&this.set(e,t,r,i,n,s,a,o,l,h,u,c,d,p,f,m)}set(e,t,r,i,n,s,a,o,l,h,u,c,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=r,g[12]=i,g[1]=n,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=h,g[10]=u,g[14]=c,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}clone(){return(new Fe).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Oe.setFromMatrixColumn(e,0).length(),n=1/Oe.setFromMatrixColumn(e,1).length(),s=1/Oe.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Be,e,Ne)}lookAt(e,t,r){const i=this.elements;return He.subVectors(e,t),0===He.lengthSq()&&(He.z=1),He.normalize(),Ge.crossVectors(r,He),0===Ge.lengthSq()&&(1===Math.abs(r.z)?He.x+=1e-4:He.z+=1e-4,He.normalize(),Ge.crossVectors(r,He)),Ge.normalize(),ze.crossVectors(He,Ge),i[0]=Ge.x,i[4]=ze.x,i[8]=He.x,i[1]=Ge.y,i[5]=ze.y,i[9]=He.y,i[2]=Ge.z,i[6]=ze.z,i[10]=He.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,n=this.elements,s=r[0],a=r[4],o=r[8],l=r[12],h=r[1],u=r[5],c=r[9],d=r[13],p=r[2],f=r[6],m=r[10],g=r[14],_=r[3],E=r[7],b=r[11],x=r[15],T=i[0],y=i[4],v=i[8],M=i[12],S=i[1],R=i[5],A=i[9],w=i[13],C=i[2],L=i[6],D=i[10],P=i[14],U=i[3],F=i[7],O=i[11],I=i[15];return n[0]=s*T+a*S+o*C+l*U,n[4]=s*y+a*R+o*L+l*F,n[8]=s*v+a*A+o*D+l*O,n[12]=s*M+a*w+o*P+l*I,n[1]=h*T+u*S+c*C+d*U,n[5]=h*y+u*R+c*L+d*F,n[9]=h*v+u*A+c*D+d*O,n[13]=h*M+u*w+c*P+d*I,n[2]=p*T+f*S+m*C+g*U,n[6]=p*y+f*R+m*L+g*F,n[10]=p*v+f*A+m*D+g*O,n[14]=p*M+f*w+m*P+g*I,n[3]=_*T+E*S+b*C+x*U,n[7]=_*y+E*R+b*L+x*F,n[11]=_*v+E*A+b*D+x*O,n[15]=_*M+E*w+b*P+x*I,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],n=e[12],s=e[1],a=e[5],o=e[9],l=e[13],h=e[2],u=e[6],c=e[10],d=e[14];return e[3]*(+n*o*u-i*l*u-n*a*c+r*l*c+i*a*d-r*o*d)+e[7]*(+t*o*d-t*l*c+n*s*c-i*s*d+i*l*h-n*o*h)+e[11]*(+t*l*u-t*a*d-n*s*u+r*s*d+n*a*h-r*l*h)+e[15]*(-i*a*h-t*o*u+t*a*c+i*s*u-r*s*c+r*o*h)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],a=e[5],o=e[6],l=e[7],h=e[8],u=e[9],c=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],_=u*m*l-f*c*l+f*o*d-a*m*d-u*o*g+a*c*g,E=p*c*l-h*m*l-p*o*d+s*m*d+h*o*g-s*c*g,b=h*f*l-p*u*l+p*a*d-s*f*d-h*a*g+s*u*g,x=p*u*o-h*f*o-p*a*c+s*f*c+h*a*m-s*u*m,T=t*_+r*E+i*b+n*x;if(0===T)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const y=1/T;return e[0]=_*y,e[1]=(f*c*n-u*m*n-f*i*d+r*m*d+u*i*g-r*c*g)*y,e[2]=(a*m*n-f*o*n+f*i*l-r*m*l-a*i*g+r*o*g)*y,e[3]=(u*o*n-a*c*n-u*i*l+r*c*l+a*i*d-r*o*d)*y,e[4]=E*y,e[5]=(h*m*n-p*c*n+p*i*d-t*m*d-h*i*g+t*c*g)*y,e[6]=(p*o*n-s*m*n-p*i*l+t*m*l+s*i*g-t*o*g)*y,e[7]=(s*c*n-h*o*n+h*i*l-t*c*l-s*i*d+t*o*d)*y,e[8]=b*y,e[9]=(p*u*n-h*f*n-p*r*d+t*f*d+h*r*g-t*u*g)*y,e[10]=(s*f*n-p*a*n+p*r*l-t*f*l-s*r*g+t*a*g)*y,e[11]=(h*a*n-s*u*n-h*r*l+t*u*l+s*r*d-t*a*d)*y,e[12]=x*y,e[13]=(h*f*i-p*u*i+p*r*c-t*f*c-h*r*m+t*u*m)*y,e[14]=(p*a*i-s*f*i-p*r*o+t*f*o+s*r*m-t*a*m)*y,e[15]=(s*u*i-h*a*i+h*r*o-t*u*o-s*r*c+t*a*c)*y,this}scale(e){const t=this.elements,r=e.x,i=e.y,n=e.z;return t[0]*=r,t[4]*=i,t[8]*=n,t[1]*=r,t[5]*=i,t[9]*=n,t[2]*=r,t[6]*=i,t[10]*=n,t[3]*=r,t[7]*=i,t[11]*=n,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,n=t._x,s=t._y,a=t._z,o=t._w,l=n+n,h=s+s,u=a+a,c=n*l,d=n*h,p=n*u,f=s*h,m=s*u,g=a*u,_=o*l,E=o*h,b=o*u,x=r.x,T=r.y,y=r.z;return i[0]=(1-(f+g))*x,i[1]=(d+b)*x,i[2]=(p-E)*x,i[3]=0,i[4]=(d-b)*T,i[5]=(1-(c+g))*T,i[6]=(m+_)*T,i[7]=0,i[8]=(p+E)*y,i[9]=(m-_)*y,i[10]=(1-(c+f))*y,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let n=Oe.set(i[0],i[1],i[2]).length();const s=Oe.set(i[4],i[5],i[6]).length(),a=Oe.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),e.x=i[12],e.y=i[13],e.z=i[14],Ie.copy(this);const o=1/n,l=1/s,h=1/a;return Ie.elements[0]*=o,Ie.elements[1]*=o,Ie.elements[2]*=o,Ie.elements[4]*=l,Ie.elements[5]*=l,Ie.elements[6]*=l,Ie.elements[8]*=h,Ie.elements[9]*=h,Ie.elements[10]*=h,t.setFromRotationMatrix(Ie),r.x=n,r.y=s,r.z=a,this}makePerspective(e,t,r,i,n,s,a=2e3){const o=this.elements,l=2*n/(t-e),h=2*n/(r-i),u=(t+e)/(t-e),c=(r+i)/(r-i);let d,p;if(a===Y)d=-(s+n)/(s-n),p=-2*s*n/(s-n);else{if(a!==K)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);d=-s/(s-n),p=-s*n/(s-n)}return o[0]=l,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=h,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=p,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,r,i,n,s,a=2e3){const o=this.elements,l=1/(t-e),h=1/(r-i),u=1/(s-n),c=(t+e)*l,d=(r+i)*h;let p,f;if(a===Y)p=(s+n)*u,f=-2*u;else{if(a!==K)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);p=n*u,f=-1*u}return o[0]=2*l,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*h,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=f,o[14]=-p,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let e=0;e<16;e++)if(t[e]!==r[e])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Oe=new Ae,Ie=new Fe,Be=new Ae(0,0,0),Ne=new Ae(1,1,1),Ge=new Ae,ze=new Ae,He=new Ae,ke=new Fe;class We{constructor(e=0,t=0,r=0,i=We.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,n=i[0],s=i[4],a=i[8],o=i[1],l=i[5],h=i[9],u=i[2],c=i[6],d=i[10];switch(t){case"XYZ":this._y=Math.asin(te(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(c,l),this._z=0);break;case"YXZ":this._x=Math.asin(-te(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-u,n),this._z=0);break;case"ZXY":this._x=Math.asin(te(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,n));break;case"ZYX":this._y=Math.asin(-te(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(c,d),this._z=Math.atan2(o,n)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(te(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-u,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-te(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(c,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-h,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return ke.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ke,t,r)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}We.DEFAULT_ORDER="XYZ";class Ve{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let Xe=0;const je=new Ae,qe=new Re,Ye=new Fe,Ke=new Ae,Ze=new Ae,Qe=new Ae(1,0,0),$e=new Ae(0,0,1),Je={type:"added"},et={type:"removed"};class tt extends Z{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Xe++}),this.uuid=ee(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=tt.DEFAULT_UP.clone();const e=new Ae,t=new We,r=new Re,i=new Ae(1,1,1);t._onChange((function(){r.setFromEuler(t,!1)})),r._onChange((function(){t.setFromQuaternion(r,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Fe},normalMatrix:{value:new ae}}),this.matrix=new Fe,this.matrixWorld=new Fe,this.matrixAutoUpdate=tt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=tt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Ve,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}translateOnAxis(e,t){return je.copy(e).applyQuaternion(this.quaternion),this.position.add(je.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Qe,e)}translateZ(e){return this.translateOnAxis($e,e)}lookAt(e,t,r){e.isVector3?Ke.copy(e):Ke.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Ze.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ye.lookAt(Ze,Ke,this.up):Ye.lookAt(Ke,Ze,this.up),this.quaternion.setFromRotationMatrix(Ye),i&&(Ye.extractRotation(i.matrixWorld),qe.setFromRotationMatrix(Ye),this.quaternion.premultiply(qe.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Je)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(et)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ye.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Ye.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ye),this.add(e),e.updateWorldMatrix(!1,!0),this}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++){const i=t[r];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(!0===e&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,r=e.length;t<r;t++){const r=e[t];!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!1,!0)}}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const r=e.children[t];this.add(r.clone())}return this}}tt.DEFAULT_UP=new Ae(0,1,0),tt.DEFAULT_MATRIX_AUTO_UPDATE=!0,tt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let rt=0;class it extends Z{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:rt++}),this.uuid=ee(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=r,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=X,this.stencilZFail=X,this.stencilZPass=X,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const r=e[t];if(void 0===r){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`)}}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){const e=t.length;r=new Array(e);for(let i=0;i!==e;++i)r[i]=t[i].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}const nt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function st(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}class at{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(void 0===t&&void 0===r){const t=e;t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=B){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,fe.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=fe.workingColorSpace){return this.r=e,this.g=t,this.b=r,fe.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=fe.workingColorSpace){var n;if(e=(e%(n=1)+n)%n,t=te(t,0,1),r=te(r,0,1),0===t)this.r=this.g=this.b=r;else{const i=r<=.5?r*(1+t):r+t-r*t,n=2*r-i;this.r=st(n,i,e+1/3),this.g=st(n,i,e),this.b=st(n,i,e-1/3)}return fe.toWorkingColorSpace(this,i),this}setStyle(e,t=B){function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let n;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,t);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,t);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const r=i[1],n=r.length;if(3===n)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,t);if(6===n)return this.setHex(parseInt(r,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=B){const r=nt[e.toLowerCase()];return void 0!==r?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=me(e.r),this.g=me(e.g),this.b=me(e.b),this}copyLinearToSRGB(e){return this.r=ge(e.r),this.g=ge(e.g),this.b=ge(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=B){return fe.fromWorkingColorSpace(ot.copy(this),e),65536*Math.round(te(255*ot.r,0,255))+256*Math.round(te(255*ot.g,0,255))+Math.round(te(255*ot.b,0,255))}getHexString(e=B){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=fe.workingColorSpace){fe.fromWorkingColorSpace(ot.copy(this),t);const r=ot.r,i=ot.g,n=ot.b,s=Math.max(r,i,n),a=Math.min(r,i,n);let o,l;const h=(a+s)/2;if(a===s)o=0,l=0;else{const e=s-a;switch(l=h<=.5?e/(s+a):e/(2-s-a),s){case r:o=(i-n)/e+(i<n?6:0);break;case i:o=(n-r)/e+2;break;case n:o=(r-i)/e+4}o/=6}return e.h=o,e.s=l,e.l=h,e}getRGB(e,t=fe.workingColorSpace){return fe.fromWorkingColorSpace(ot.copy(this),t),e.r=ot.r,e.g=ot.g,e.b=ot.b,e}getStyle(e=B){fe.fromWorkingColorSpace(ot.copy(this),e);const t=ot.r,r=ot.g,i=ot.b;return e!==B?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*t)},${Math.round(255*r)},${Math.round(255*i)})`}offsetHSL(e,t,r){return this.getHSL(_hslA),this.setHSL(_hslA.h+e,_hslA.s+t,_hslA.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(_hslA),e.getHSL(_hslB);const r=lerp(_hslA.h,_hslB.h,t),i=lerp(_hslA.s,_hslB.s,t),n=lerp(_hslA.l,_hslB.l,t);return this.setHSL(r,i,n),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,n=e.elements;return this.r=n[0]*t+n[3]*r+n[6]*i,this.g=n[1]*t+n[4]*r+n[7]*i,this.b=n[2]*t+n[5]*r+n[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ot=new at;at.NAMES=nt;const lt=new Ae,ht=new se;class ut{constructor(e,t){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.gpuType=M,this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)ht.fromBufferAttribute(this,t),ht.applyMatrix3(e),this.setXY(t,ht.x,ht.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)lt.fromBufferAttribute(this,t),lt.applyMatrix3(e),this.setXYZ(t,lt.x,lt.y,lt.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)lt.fromBufferAttribute(this,t),lt.applyMatrix4(e),this.setXYZ(t,lt.x,lt.y,lt.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)lt.fromBufferAttribute(this,t),lt.applyNormalMatrix(e),this.setXYZ(t,lt.x,lt.y,lt.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)lt.fromBufferAttribute(this,t),lt.transformDirection(e),this.setXYZ(t,lt.x,lt.y,lt.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){return this.array[e*this.itemSize+t]}getX(e){return this.array[e*this.itemSize]}getY(e){return this.array[e*this.itemSize+1]}getZ(e){return this.array[e*this.itemSize+2]}getW(e){return this.array[e*this.itemSize+3]}setXY(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=n,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}}class ct extends ut{constructor(e,t){super(new Uint16Array(e),t)}}class dt extends ut{constructor(e,t){super(new Uint32Array(e),t)}}class pt extends ut{constructor(e,t){super(new Float32Array(e),t)}}let ft=0;const mt=new Fe,gt=new tt,_t=new Ae,Et=new we,bt=new we,xt=new Ae;class Tt extends Z{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ft++}),this.uuid=ee(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(le(e)?dt:ct)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const t=(new ae).getNormalMatrix(e);r.applyNormalMatrix(t),r.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return mt.makeRotationFromQuaternion(e),this.applyMatrix4(mt),this}scale(e,t,r){return mt.makeScale(e,t,r),this.applyMatrix4(mt),this}lookAt(e){return gt.lookAt(e),gt.updateMatrix(),this.applyMatrix4(gt.matrix),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new pt(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new we);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Ae(-1/0,-1/0,-1/0),new Ae(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const r=t[e];Et.setFromBufferAttribute(r),this.morphTargetsRelative?(xt.addVectors(this.boundingBox.min,Et.min),this.boundingBox.expandByPoint(xt),xt.addVectors(this.boundingBox.max,Et.max),this.boundingBox.expandByPoint(xt)):(this.boundingBox.expandByPoint(Et.min),this.boundingBox.expandByPoint(Et.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ue);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Ae,1/0);if(e){const r=this.boundingSphere.center;if(Et.setFromBufferAttribute(e),t)for(let e=0,r=t.length;e<r;e++){const r=t[e];bt.setFromBufferAttribute(r),this.morphTargetsRelative?(xt.addVectors(Et.min,bt.min),Et.expandByPoint(xt),xt.addVectors(Et.max,bt.max),Et.expandByPoint(xt)):(Et.expandByPoint(bt.min),Et.expandByPoint(bt.max))}Et.getCenter(r);let i=0;for(let t=0,n=e.count;t<n;t++)xt.fromBufferAttribute(e,t),i=Math.max(i,r.distanceToSquared(xt));if(t)for(let n=0,s=t.length;n<s;n++){const s=t[n],a=this.morphTargetsRelative;for(let t=0,n=s.count;t<n;t++)xt.fromBufferAttribute(s,t),a&&(_t.fromBufferAttribute(e,t),xt.add(_t)),i=Math.max(i,r.distanceToSquared(xt))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;null!==r&&this.setIndex(r.clone(t));const i=e.attributes;for(const e in i){const r=i[e];this.setAttribute(e,r.clone(t))}const n=e.morphAttributes;for(const e in n){const r=[],i=n[e];for(let e=0,n=i.length;e<n;e++)r.push(i[e].clone(t));this.morphAttributes[e]=r}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let e=0,t=s.length;e<t;e++){const t=s[e];this.addGroup(t.start,t.count,t.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=e.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}class yt extends tt{constructor(e,t){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){const r=e[t[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,t=r.length;e<t;e++){const t=r[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[t]=e}}}}}class vt extends Tt{constructor(e=1,t=1,r=1,i=1,n=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:n,depthSegments:s};const a=this;i=Math.floor(i),n=Math.floor(n),s=Math.floor(s);const o=[],l=[],h=[],u=[];let c=0,d=0;function p(e,t,r,i,n,s,p,f,m,g,_){const E=s/m,b=p/g,x=s/2,T=p/2,y=f/2,v=m+1,M=g+1;let S=0,R=0;const A=new Ae;for(let s=0;s<M;s++){const a=s*b-T;for(let o=0;o<v;o++){const c=o*E-x;A[e]=c*i,A[t]=a*n,A[r]=y,l.push(A.x,A.y,A.z),A[e]=0,A[t]=0,A[r]=f>0?1:-1,h.push(A.x,A.y,A.z),u.push(o/m),u.push(1-s/g),S+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const r=c+t+v*e,i=c+t+v*(e+1),n=c+(t+1)+v*(e+1),s=c+(t+1)+v*e;o.push(r,i,s),o.push(i,n,s),R+=6}a.addGroup(d,R,_),d+=R,c+=S}p("z","y","x",-1,-1,r,t,e,s,n,0),p("z","y","x",1,-1,r,t,-e,s,n,1),p("x","z","y",1,1,e,r,t,i,s,2),p("x","z","y",1,-1,e,r,-t,i,s,3),p("x","y","z",1,-1,e,t,r,i,n,4),p("x","y","z",-1,-1,e,t,-r,i,n,5),this.setIndex(o),this.setAttribute("position",new pt(l,3)),this.setAttribute("normal",new pt(h,3)),this.setAttribute("uv",new pt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vt(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Mt(e){const t={};for(const r in e){t[r]={};for(const i in e[r]){const n=e[r][i];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture||n.isQuaternion)?n.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[r][i]=null):t[r][i]=n.clone():Array.isArray(n)?t[r][i]=n.slice():t[r][i]=n}}return t}class St extends it{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}}class Rt extends tt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Fe,this.projectionMatrix=new Fe,this.projectionMatrixInverse=new Fe,this.coordinateSystem=Y}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class At extends Rt{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*J*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*$*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*J*Math.atan(Math.tan(.5*$*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,n,s){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=n,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*$*this.fov)/this.zoom,r=2*t,i=this.aspect*r,n=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const e=s.fullWidth,a=s.fullHeight;n+=s.offsetX*i/e,t-=s.offsetY*r/a,i*=s.width/e,r*=s.height/a}const a=this.filmOffset;0!==a&&(n+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}}const wt=-90;class Ct extends tt{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new At(wt,1,e,t);i.layers=this.layers,this.add(i);const n=new At(wt,1,e,t);n.layers=this.layers,this.add(n);const s=new At(wt,1,e,t);s.layers=this.layers,this.add(s);const a=new At(wt,1,e,t);a.layers=this.layers,this.add(a);const o=new At(wt,1,e,t);o.layers=this.layers,this.add(o);const l=new At(wt,1,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,n,s,a,o]=t;for(const e of t)this.remove(e);if(e===Y)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),o.up.set(0,1,0),o.lookAt(0,0,-1);else{if(e!==K)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),o.up.set(0,-1,0),o.lookAt(0,0,-1)}for(const e of t)this.add(e),e.updateMatrixWorld()}update(e,t){null===this.parent&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[n,s,a,o,l,h]=this.children,u=e.getRenderTarget(),c=e.getActiveCubeFace(),d=e.getActiveMipmapLevel(),p=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,n),e.setRenderTarget(r,1,i),e.render(t,s),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,o),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=p,e.setRenderTarget(r,5,i),e.render(t,h),e.setRenderTarget(u,c,d),r.texture.needsPMREMUpdate=!0}}class Lt extends ye{constructor(e,t,r,i,n,s,a,o,l,h){super(e=void 0!==e?e:[],t=void 0!==t?t:d,r,i,n,s,a,o,l,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Dt extends Se{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];void 0!==t.encoding&&(de("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===O?B:I),this.texture=new Lt(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:E}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new vt(5,5,5),n=new St({name:"CubemapFromEquirect",uniforms:Mt(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:1,blending:0});n.uniforms.tEquirect.value=t;const s=new yt(i,n),a=t.minFilter;t.minFilter===b&&(t.minFilter=E);return new Ct(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t,r,i){const n=e.getRenderTarget();for(let n=0;n<6;n++)e.setRenderTarget(this,n),e.clear(t,r,i);e.setRenderTarget(n)}}const Pt=new Ae,Ut=new Ae,Ft=new ae;class Ot{constructor(e=new Ae(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=Pt.subVectors(r,t).cross(Ut.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||Ft.getNormalMatrix(e),i=this.coplanarPoint(Pt).applyMatrix4(e),n=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(n),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const It=new Ue;class Bt{constructor(e=new Ot,t=new Ot,r=new Ot,i=new Ot,n=new Ot,s=new Ot){this.planes=[e,t,r,i,n,s]}set(e,t,r,i,n,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(n),a[5].copy(s),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=2e3){const r=this.planes,i=e.elements,n=i[0],s=i[1],a=i[2],o=i[3],l=i[4],h=i[5],u=i[6],c=i[7],d=i[8],p=i[9],f=i[10],m=i[11],g=i[12],_=i[13],E=i[14],b=i[15];if(r[0].setComponents(o-n,c-l,m-d,b-g).normalize(),r[1].setComponents(o+n,c+l,m+d,b+g).normalize(),r[2].setComponents(o+s,c+h,m+p,b+_).normalize(),r[3].setComponents(o-s,c-h,m-p,b-_).normalize(),r[4].setComponents(o-a,c-u,m-f,b-E).normalize(),t===Y)r[5].setComponents(o+a,c+u,m+f,b+E).normalize();else{if(t!==K)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);r[5].setComponents(a,u,f,E).normalize()}return this}intersectsObject(e){if(void 0!==e.boundingSphere)null===e.boundingSphere&&e.computeBoundingSphere(),It.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;null===t.boundingSphere&&t.computeBoundingSphere(),It.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(It)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(r)<i)return!1}return!0}clone(){return(new this.constructor).copy(this)}}function Nt(){let e=null,t=!1,r=null,i=null;function n(t,s){r(t,s),i=e.requestAnimationFrame(n)}return{start:function(){!0!==t&&null!==r&&(i=e.requestAnimationFrame(n),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){r=e},setContext:function(t){e=t}}}function Gt(e,t){const r=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const r=i.get(t);r&&(e.deleteBuffer(r.buffer),i.delete(t))},update:function(t,n){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const s=i.get(t);void 0===s?i.set(t,function(t,i){const n=t.array,s=t.usage,a=e.createBuffer();let o;if(e.bindBuffer(i,a),e.bufferData(i,n,s),t.onUploadCallback(),n instanceof Float32Array)o=e.FLOAT;else if(n instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!r)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=e.HALF_FLOAT}else o=e.UNSIGNED_SHORT;else if(n instanceof Int16Array)o=e.SHORT;else if(n instanceof Uint32Array)o=e.UNSIGNED_INT;else if(n instanceof Int32Array)o=e.INT;else if(n instanceof Int8Array)o=e.BYTE;else if(n instanceof Uint8Array)o=e.UNSIGNED_BYTE;else{if(!(n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);o=e.UNSIGNED_BYTE}return{buffer:a,type:o,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version}}(t,n)):s.version<t.version&&(!function(t,i,n){const s=i.array,a=i.updateRange;e.bindBuffer(n,t),-1===a.count?e.bufferSubData(n,0,s):(r?e.bufferSubData(n,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):e.bufferSubData(n,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1),i.onUploadCallback()}(s.buffer,t,n),s.version=t.version)}}}var zt="\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",Ht="#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }";const kt={begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif"},Wt={background:{uniforms:{uvTransform:{value:new ae},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",fragmentShader:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}"},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",fragmentShader:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}"}},Vt={r:0,b:0,g:0};function Xt(e,t,r,i,n,s,a){const o=new at(0);let l,h=!0===s?0:1,u=null,c=0,d=null;function p(t,r){t.getRGB(Vt,function(e){return null===e.getRenderTarget()?e.outputColorSpace:fe.workingColorSpace}(e)),i.buffers.color.setClear(Vt.r,Vt.g,Vt.b,r,a)}return{getClearColor:function(){return o},setClearColor:function(e,t=1){o.set(e),h=t,p(o,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,p(o,h)},render:function(i,s){let a=!1,m=!0===s.isScene?s.background:null;if(m&&m.isTexture){m=(s.backgroundBlurriness>0?r:t).get(m)}null===m?p(o,h):m&&m.isColor&&(p(m,1),a=!0),(e.autoClear||a)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.mapping===f)&&(void 0===l&&(l=new yt(new vt(1,1,1),new St({name:"BackgroundCubeMaterial",uniforms:Mt(Wt.backgroundCube.uniforms),vertexShader:Wt.backgroundCube.vertexShader,fragmentShader:Wt.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(e,t,r){this.matrixWorld.copyPosition(r.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=m,l.material.uniforms.flipEnvMap.value=m.isCubeTexture&&!1===m.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=s.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=s.backgroundIntensity,l.material.toneMapped=fe.getTransfer(m.colorSpace)!==k,u===m&&c===m.version&&d===e.toneMapping||(l.material.needsUpdate=!0,u=m,c=m.version,d=e.toneMapping),l.layers.enableAll(),i.unshift(l,l.geometry,l.material,0,0,null))}}}function jt(e,t,r,i){const n=e.getParameter(e.MAX_VERTEX_ATTRIBS),s=i.isWebGL2?null:t.get("OES_vertex_array_object"),a=i.isWebGL2||null!==s,o={},l=p(null);let h=l,u=!1;function c(t){return i.isWebGL2?e.bindVertexArray(t):s.bindVertexArrayOES(t)}function d(t){return i.isWebGL2?e.deleteVertexArray(t):s.deleteVertexArrayOES(t)}function p(e){const t=[],r=[],i=[];for(let e=0;e<n;e++)t[e]=0,r[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:r,attributeDivisors:i,object:e,attributes:{},index:null}}function f(){const e=h.newAttributes;for(let t=0,r=e.length;t<r;t++)e[t]=0}function m(r){!function(r,n){const s=h.newAttributes,a=h.enabledAttributes,o=h.attributeDivisors;s[r]=1,0===a[r]&&(e.enableVertexAttribArray(r),a[r]=1);if(o[r]!==n){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](r,n),o[r]=n}}(r,0)}function g(){const t=h.newAttributes,r=h.enabledAttributes;for(let i=0,n=r.length;i<n;i++)r[i]!==t[i]&&(e.disableVertexAttribArray(i),r[i]=0)}function _(t,r,i,n,s,a,o){!0===o?e.vertexAttribIPointer(t,r,i,s,a):e.vertexAttribPointer(t,r,i,n,s,a)}function E(){b(),u=!0,h!==l&&(h=l,c(h.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(t,n,l,d,E){let b=!1;if(a){const r=function(t,r,n){const a=!0===n.wireframe;let l=o[t.id];void 0===l&&(l={},o[t.id]=l);let h=l[r.id];void 0===h&&(h={},l[r.id]=h);let u=h[a];void 0===u&&(u=p(i.isWebGL2?e.createVertexArray():s.createVertexArrayOES()),h[a]=u);return u}(d,l,n);h!==r&&(h=r,c(h.object)),b=function(e,t,r,i){const n=h.attributes,s=t.attributes;let a=0;const o=r.getAttributes();for(const t in o){if(o[t].location>=0){const r=n[t];let i=s[t];if(void 0===i&&("instanceMatrix"===t&&e.instanceMatrix&&(i=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(i=e.instanceColor)),void 0===r)return!0;if(r.attribute!==i)return!0;if(i&&r.data!==i.data)return!0;a++}}return h.attributesNum!==a||h.index!==i}(t,d,l,E),b&&function(e,t,r,i){const n={},s=t.attributes;let a=0;const o=r.getAttributes();for(const t in o){if(o[t].location>=0){let r=s[t];void 0===r&&("instanceMatrix"===t&&e.instanceMatrix&&(r=e.instanceMatrix),"instanceColor"===t&&e.instanceColor&&(r=e.instanceColor));const i={};i.attribute=r,r&&r.data&&(i.data=r.data),n[t]=i,a++}}h.attributes=n,h.attributesNum=a,h.index=i}(t,d,l,E)}else{const e=!0===n.wireframe;h.geometry===d.id&&h.program===l.id&&h.wireframe===e||(h.geometry=d.id,h.program=l.id,h.wireframe=e,b=!0)}null!==E&&r.update(E,e.ELEMENT_ARRAY_BUFFER),(b||u)&&(u=!1,function(t,n,s,a){f();const o=a.attributes,l=s.getAttributes(),h=n.defaultAttributeValues;for(const n in l){const s=l[n];if(s.location>=0){let a=o[n];if(void 0===a&&("instanceMatrix"===n&&t.instanceMatrix&&(a=t.instanceMatrix),"instanceColor"===n&&t.instanceColor&&(a=t.instanceColor)),void 0!==a){const t=a.normalized,n=a.itemSize,o=r.get(a);if(void 0===o)continue;const l=o.buffer,h=o.type,u=o.bytesPerElement,c=!0===i.isWebGL2&&(h===e.INT||h===e.UNSIGNED_INT||a.gpuType===y);if(a.isInterleavedBufferAttribute){const r=a.data.stride,i=a.offset;for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,l);for(let e=0;e<s.locationSize;e++)_(s.location+e,n/s.locationSize,h,t,r*u,(i+n/s.locationSize*e)*u,c)}else{for(let e=0;e<s.locationSize;e++)m(s.location+e);e.bindBuffer(e.ARRAY_BUFFER,l);for(let e=0;e<s.locationSize;e++)_(s.location+e,n/s.locationSize,h,t,n*u,n/s.locationSize*e*u,c)}}else if(void 0!==h){const t=h[n];if(void 0!==t)switch(t.length){case 2:e.vertexAttrib2fv(s.location,t);break;case 3:e.vertexAttrib3fv(s.location,t);break;case 4:e.vertexAttrib4fv(s.location,t);break;default:e.vertexAttrib1fv(s.location,t)}}}}g()}(t,n,l,d),null!==E&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.get(E).buffer))},reset:E,resetDefaultState:b,dispose:function(){E();for(const e in o){const t=o[e];for(const e in t){const r=t[e];for(const e in r)d(r[e].object),delete r[e];delete t[e]}delete o[e]}},releaseStatesOfGeometry:function(e){if(void 0===o[e.id])return;const t=o[e.id];for(const e in t){const r=t[e];for(const e in r)d(r[e].object),delete r[e];delete t[e]}delete o[e.id]},releaseStatesOfProgram:function(e){for(const t in o){const r=o[t];if(void 0===r[e.id])continue;const i=r[e.id];for(const e in i)d(i[e].object),delete i[e];delete r[e.id]}},initAttributes:f,enableAttribute:m,disableUnusedAttributes:g}}function qt(e,t,r,i){const n=i.isWebGL2;let s;this.setMode=function(e){s=e},this.render=function(t,i){e.drawArrays(s,t,i),r.update(i,s,1)},this.renderInstances=function(i,a,o){if(0===o)return;let l,h;if(n)l=e,h="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),h="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](s,i,a,o),r.update(a,s,o)}}function Yt(e,t,r){let i;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===e.constructor.name;let a=void 0!==r.precision?r.precision:"highp";const o=n(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||t.has("WEBGL_draw_buffers"),h=!0===r.logarithmicDepthBuffer,u=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=e.getParameter(e.MAX_TEXTURE_SIZE),p=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),m=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),g=e.getParameter(e.MAX_VARYING_VECTORS),_=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),E=c>0,b=s||t.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const r=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:n,precision:a,logarithmicDepthBuffer:h,maxTextures:u,maxVertexTextures:c,maxTextureSize:d,maxCubemapSize:p,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:_,vertexTextures:E,floatFragmentTextures:b,floatVertexTextures:E&&b,maxSamples:s?e.getParameter(e.MAX_SAMPLES):0}}function Kt(e){const t=this;let r=null,i=0,n=!1,s=!1;const a=new Ot,o=new ae,l={value:null,needsUpdate:!1};function h(e,r,i,n){const s=null!==e?e.length:0;let h=null;if(0!==s){if(h=l.value,!0!==n||null===h){const t=i+4*s,n=r.matrixWorldInverse;o.getNormalMatrix(n),(null===h||h.length<t)&&(h=new Float32Array(t));for(let t=0,r=i;t!==s;++t,r+=4)a.copy(e[t]).applyMatrix4(n,o),a.normal.toArray(h,r),h[r+3]=a.constant}l.value=h,l.needsUpdate=!0}return t.numPlanes=s,t.numIntersection=0,h}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t){const r=0!==e.length||t||0!==i||n;return n=t,i=e.length,r},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(e,t){r=h(e,t,0)},this.setState=function(a,o,u){const c=a.clippingPlanes,d=a.clipIntersection,p=a.clipShadows,f=e.get(a);if(!n||null===c||0===c.length||s&&!p)s?h(null):function(){l.value!==r&&(l.value=r,l.needsUpdate=i>0);t.numPlanes=i,t.numIntersection=0}();else{const e=s?0:i,t=4*e;let n=f.clippingState||null;l.value=n,n=h(c,o,t,u);for(let e=0;e!==t;++e)n[e]=r[e];f.clippingState=n,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}function Zt(e){let t=new WeakMap;function r(e,t){return 303===t?e.mapping=d:304===t&&(e.mapping=p),e}function i(e){const r=e.target;r.removeEventListener("dispose",i);const n=t.get(r);void 0!==n&&(t.delete(r),n.dispose())}return{get:function(n){if(n&&n.isTexture&&!1===n.isRenderTargetTexture){const s=n.mapping;if(303===s||304===s){if(t.has(n)){return r(t.get(n).texture,n.mapping)}{const s=n.image;if(s&&s.height>0){const a=new Dt(s.height/2);return a.fromEquirectangularTexture(e,n),t.set(n,a),n.addEventListener("dispose",i),r(a.texture,n.mapping)}return null}}}return n},dispose:function(){t=new WeakMap}}}function Qt(){return{get:()=>{},dispose:()=>{}}}function $t(e){const t={};function r(r){if(void 0!==t[r])return t[r];let i;switch(r){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(r)}return t[r]=i,i}return{has:function(e){return null!==r(e)},init:function(e){e.isWebGL2?r("EXT_color_buffer_float"):(r("WEBGL_depth_texture"),r("OES_texture_float"),r("OES_texture_half_float"),r("OES_texture_half_float_linear"),r("OES_standard_derivatives"),r("OES_element_index_uint"),r("OES_vertex_array_object"),r("ANGLE_instanced_arrays")),r("OES_texture_float_linear"),r("EXT_color_buffer_half_float"),r("WEBGL_multisampled_render_to_texture")},get:function(e){const t=r(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Jt(e,t,r,i){const n={},s=new WeakMap;function a(e){const o=e.target;null!==o.index&&t.remove(o.index);for(const e in o.attributes)t.remove(o.attributes[e]);for(const e in o.morphAttributes){const r=o.morphAttributes[e];for(let e=0,i=r.length;e<i;e++)t.remove(r[e])}o.removeEventListener("dispose",a),delete n[o.id];const l=s.get(o);l&&(t.remove(l),s.delete(o)),i.releaseStatesOfGeometry(o),r.memory.geometries--}function o(e){const r=[],i=e.index,n=e.attributes.position;let a=0;if(null!==i){const e=i.array;a=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],n=e[t+1],s=e[t+2];r.push(i,n,n,s,s,i)}}else{if(void 0===n)return;{const e=n.array;a=n.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,n=t+2;r.push(e,i,i,n,n,e)}}}const o=new(le(r)?dt:ct)(r,1);o.version=a;const l=s.get(e);l&&t.remove(l),s.set(e,o)}return{get:function(e,t){return!0===n[t.id]||(t.addEventListener("dispose",a),n[t.id]=!0,r.memory.geometries++),t},update:function(r){const i=r.attributes;for(const r in i)t.update(i[r],e.ARRAY_BUFFER);const n=r.morphAttributes;for(const r in n){const i=n[r];for(let r=0,n=i.length;r<n;r++)t.update(i[r],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=s.get(e);if(t){const r=e.index;null!==r&&t.version<r.version&&o(e)}else o(e);return s.get(e)}}}function er(e,t,r,i){const n=i.isWebGL2;let s,a,o;this.setMode=function(e){s=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,i){e.drawElements(s,i,a,t*o),r.update(i,s,1)},this.renderInstances=function(i,l,h){if(0===h)return;let u,c;if(n)u=e,c="drawElementsInstanced";else if(u=t.get("ANGLE_instanced_arrays"),c="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[c](s,l,a,i*o,h),r.update(l,s,h)}}function tr(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(r,i,n){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=n*(r/3);break;case e.LINES:t.lines+=n*(r/2);break;case e.LINE_STRIP:t.lines+=n*(r-1);break;case e.LINE_LOOP:t.lines+=n*r;break;case e.POINTS:t.points+=n*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function rr(e,t,r,i){let n=new WeakMap;return{update:function(e){const r=i.render.frame,s=e.geometry,a=t.get(e,s);if(n.get(a)!==r&&(t.update(a),n.set(a,r)),e.isSkinnedMesh){const t=e.skeleton;n.get(t)!==r&&(t.update(),n.set(t,r))}return a},dispose:function(){n=new WeakMap}}}const ir=new ye,nr=new Lt,sr=new Float32Array(16);function ar(e,t){if(e.length!==t.length)return!1;for(let r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return!1;return!0}function or(e,t){for(let r=0,i=t.length;r<i;r++)e[r]=t[r]}function lr(e,t){const r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function hr(e,t){const r=this.cache,i=t.elements;if(void 0===i){if(ar(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),or(r,t)}else{if(ar(r,i))return;sr.set(i),e.uniformMatrix4fv(this.addr,!1,sr),or(r,i)}}function ur(e,t,r){const i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTexture2D(t||ir,n)}function cr(e,t,r){const i=this.cache,n=r.allocateTextureUnit();i[0]!==n&&(e.uniform1i(this.addr,n),i[0]=n),r.setTextureCube(t||nr,n)}class dr{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return lr;case 35676:return hr;case 35678:case 36198:case 36298:case 36306:case 35682:return ur;case 35680:case 36300:case 36308:case 36293:return cr}}(t.type)}}class pr{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let n=0,s=i.length;n!==s;++n){const s=i[n];s.setValue(e,t[s.id],r)}}}const fr=/(\w+)(\])?(\[|\.)?/g;function mr(e,t){e.seq.push(t),e.map[t.id]=t}function gr(e,t,r){const i=e.name,n=i.length;for(fr.lastIndex=0;;){const s=fr.exec(i),a=fr.lastIndex;let o=s[1];const l="]"===s[2],h=s[3];if(l&&(o|=0),void 0===h||"["===h&&a+2===n){mr(r,new dr(o,e,t));break}{let e=r.map[o];void 0===e&&(e=new pr(o),mr(r,e)),r=e}}}class _r{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const r=e.getActiveUniform(t,i);gr(r,e.getUniformLocation(t,r.name),this)}}setValue(e,t,r,i){const n=this.map[t];void 0!==n&&n.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];void 0!==i&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let n=0,s=t.length;n!==s;++n){const s=t[n],a=r[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,n=e.length;i!==n;++i){const n=e[i];n.id in t&&r.push(n)}return r}}function Er(e,t,r){const i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}let br=0;function Tr(e,t,r){const i=e.getShaderParameter(t,e.COMPILE_STATUS),n=e.getShaderInfoLog(t).trim();if(i&&""===n)return"";const s=/ERROR: 0:(\d+)/.exec(n);if(s){const i=parseInt(s[1]);return r.toUpperCase()+"\n\n"+n+"\n\n"+function(e,t){const r=e.split("\n"),i=[],n=Math.max(t-6,0),s=Math.min(t+6,r.length);for(let e=n;e<s;e++){const n=e+1;i.push(`${n===t?">":" "} ${n}: ${r[e]}`)}return i.join("\n")}(e.getShaderSource(t),i)}return n}function yr(e,t){const r=function(e){const t=fe.getPrimaries(fe.workingColorSpace),r=fe.getPrimaries(e);let i;switch(t===r?i="":t===V&&r===W?i="LinearDisplayP3ToLinearSRGB":t===W&&r===V&&(i="LinearSRGBToLinearDisplayP3"),e){case N:case z:return[i,"LinearTransferOETF"];case B:case G:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",e),[i,"LinearTransferOETF"]}}(t);return`vec4 ${e}( vec4 value ) { return ${r[0]}( ${r[1]}( value ) ); }`}function vr(e,t){let r;switch(t){case o:r="Linear";break;case l:r="Reinhard";break;case h:r="OptimizedCineon";break;case u:r="ACESFilmic";break;case c:r="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),r="Linear"}return"vec3 "+e+"( vec3 color ) { return "+r+"ToneMapping( color ); }"}function Mr(e){return""!==e}function Sr(e,t){const r=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,r).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Rr(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Ar=/^[ \t]*#include +<([\w\d./]+)>/gm;function wr(e){return e.replace(Ar,Lr)}const Cr=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function Lr(e,t){let r=kt[t];if(void 0===r){const e=Cr.get(t);if(void 0===e)throw new Error("Can not resolve #include <"+t+">");r=kt[e],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,e)}return wr(r)}const Dr=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Pr(e){return e.replace(Dr,Ur)}function Ur(e,t,r,i){let n="";for(let e=parseInt(t);e<parseInt(r);e++)n+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return n}function Fr(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Or(e,t,r,o){const l=e.getContext(),h=r.defines;let u=r.vertexShader,c=r.fragmentShader;const m=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case d:case p:t="ENVMAP_TYPE_CUBE";break;case f:t="ENVMAP_TYPE_CUBE_UV"}return t}(r),g=function(e){let t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===p&&(t="ENVMAP_MODE_REFRACTION");return t}(r),_=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case i:t="ENVMAP_BLENDING_MULTIPLY";break;case n:t="ENVMAP_BLENDING_MIX";break;case s:t="ENVMAP_BLENDING_ADD"}return t}(r),E=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const r=Math.log2(t)-2,i=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,r),112)),texelHeight:i,maxMip:r}}(r),b=r.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.normalMapTangentSpace||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Mr).join("\n")}(r),x=function(e){const t=[];for(const r in e){const i=e[r];!1!==i&&t.push("#define "+r+" "+i)}return t.join("\n")}(h),T=l.createProgram();let y,v,M=r.glslVersion?"#version "+r.glslVersion+"\n":"";y=[Fr(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,x,r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+g:"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Mr).join("\n"),v=[b,Fr(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,x,r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+m:"",r.envMap?"#define "+g:"",r.envMap?"#define "+_:"",E?"#define CUBEUV_TEXEL_WIDTH "+E.texelWidth:"",E?"#define CUBEUV_TEXEL_HEIGHT "+E.texelHeight:"",E?"#define CUBEUV_MAX_MIP "+E.maxMip+".0":"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescence?"#define USE_IRIDESCENCE":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","","",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.useLegacyLights?"#define LEGACY_LIGHTS":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==a?"#define TONE_MAPPING":"",r.toneMapping!==a?Ht:"",r.toneMapping!==a?vr("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.opaque?"#define OPAQUE":"",zt,yr("linearToOutputTexel",r.outputColorSpace),r.useDepthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(Mr).join("\n"),u=wr(u),u=Sr(u,r),u=Rr(u,r),c=wr(c),c=Sr(c,r),c=Rr(c,r),u=Pr(u),c=Pr(c),r.isWebGL2&&!0!==r.isRawShaderMaterial&&(M="#version 300 es\n",y=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+y,v=["#define varying in",r.glslVersion===j?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===j?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const S=M+y+u,R=M+v+c,A=Er(l,l.VERTEX_SHADER,S),w=Er(l,l.FRAGMENT_SHADER,R);if(l.attachShader(T,A),l.attachShader(T,w),void 0!==r.index0AttributeName?l.bindAttribLocation(T,0,r.index0AttributeName):!0===r.morphTargets&&l.bindAttribLocation(T,0,"position"),l.linkProgram(T),e.debug.checkShaderErrors){const t=l.getProgramInfoLog(T).trim(),r=l.getShaderInfoLog(A).trim(),i=l.getShaderInfoLog(w).trim();let n=!0,s=!0;if(!1===l.getProgramParameter(T,l.LINK_STATUS))if(n=!1,"function"==typeof e.debug.onShaderError)e.debug.onShaderError(l,T,A,w);else{const e=Tr(l,A,"vertex"),r=Tr(l,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+l.getError()+" - VALIDATE_STATUS "+l.getProgramParameter(T,l.VALIDATE_STATUS)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+r)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==r&&""!==i||(s=!1);s&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:r,prefix:y},fragmentShader:{log:i,prefix:v}})}let C,L;return l.deleteShader(A),l.deleteShader(w),this.getUniforms=function(){return void 0===C&&(C=new _r(l,T)),C},this.getAttributes=function(){return void 0===L&&(L=function(e,t){const r={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let n=0;n<i;n++){const i=e.getActiveAttrib(t,n),s=i.name;let a=1;i.type===e.FLOAT_MAT2&&(a=2),i.type===e.FLOAT_MAT3&&(a=3),i.type===e.FLOAT_MAT4&&(a=4),r[s]={type:i.type,location:e.getAttribLocation(t,s),locationSize:a}}return r}(l,T)),L},this.destroy=function(){o.releaseStatesOfProgram(this),l.deleteProgram(T),this.program=void 0},this.type=r.shaderType,this.name=r.shaderName,this.id=br++,this.cacheKey=t,this.usedTimes=1,this.program=T,this.vertexShader=A,this.fragmentShader=w,this}let Ir=0;class Br{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),n=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(n)&&(s.add(n),n.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return void 0===r&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return void 0===r&&(r=new Nr(e),t.set(e,r)),r}}class Nr{constructor(e){this.id=Ir++,this.code=e,this.usedTimes=0}}function Gr(e,t,r,i,n,s,o){const l=new Ve,h=new Br,u=[],c=n.isWebGL2,d=n.logarithmicDepthBuffer,p=n.vertexTextures;let m=n.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(e){return 0===e?"uv":`uv${e}`}return{getParameters:function(s,l,u,E,b){const x=E.fog,T=b.geometry,y=s.isMeshStandardMaterial?E.environment:null,v=(s.isMeshStandardMaterial?r:t).get(s.envMap||y),M=v&&v.mapping===f?v.image.height:null,S=g[s.type];null!==s.precision&&(m=n.getMaxPrecision(s.precision),m!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",m,"instead."));const R=T.morphAttributes.position||T.morphAttributes.normal||T.morphAttributes.color,A=void 0!==R?R.length:0;let w,C,L,D,P=0;if(void 0!==T.morphAttributes.position&&(P=1),void 0!==T.morphAttributes.normal&&(P=2),void 0!==T.morphAttributes.color&&(P=3),S){console.log(Wt[S],"ShaderLib[ shaderID ]");const e=Wt[S];w=e.vertexShader,C=e.fragmentShader}else w=s.vertexShader,C=s.fragmentShader,h.update(s),L=h.getVertexShaderID(s),D=h.getFragmentShaderID(s);const U=e.getRenderTarget(),F=!!s.map,O=!!s.matcap,I=!!v,B=!!s.aoMap,G=!!s.lightMap,z=!!s.bumpMap,H=!!s.normalMap,W=!!s.displacementMap,V=!!s.emissiveMap,X=!!s.metalnessMap,j=!!s.roughnessMap,q=s.anisotropy>0,Y=s.clearcoat>0,K=s.iridescence>0,Z=s.sheen>0,Q=s.transmission>0,$=q&&!!s.anisotropyMap,J=Y&&!!s.clearcoatMap,ee=Y&&!!s.clearcoatNormalMap,te=Y&&!!s.clearcoatRoughnessMap,re=K&&!!s.iridescenceMap,ie=K&&!!s.iridescenceThicknessMap,ne=Z&&!!s.sheenColorMap,se=Z&&!!s.sheenRoughnessMap,ae=!!s.specularMap,oe=!!s.specularColorMap,le=!!s.specularIntensityMap,he=Q&&!!s.transmissionMap,ue=Q&&!!s.thicknessMap,ce=!!s.gradientMap,de=!!s.alphaMap,pe=s.alphaTest>0,me=!!s.alphaHash,ge=!!s.extensions,_e=!!T.attributes.uv1,Ee=!!T.attributes.uv2,be=!!T.attributes.uv3;let xe=a;return s.toneMapped&&(null!==U&&!0!==U.isXRRenderTarget||(xe=e.toneMapping)),{isWebGL2:c,shaderID:S,shaderType:s.type,shaderName:s.name,vertexShader:w,fragmentShader:C,defines:s.defines,customVertexShaderID:L,customFragmentShaderID:D,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:m,instancing:!1,instancingColor:!1,supportsVertexTextures:p,outputColorSpace:null===U?e.outputColorSpace:!0===U.isXRRenderTarget?U.texture.colorSpace:N,map:F,matcap:O,envMap:I,envMapMode:I&&v.mapping,envMapCubeUVHeight:M,aoMap:B,lightMap:G,bumpMap:z,normalMap:H,displacementMap:p&&W,emissiveMap:V,normalMapObjectSpace:H&&1===s.normalMapType,normalMapTangentSpace:H&&0===s.normalMapType,metalnessMap:X,roughnessMap:j,anisotropy:q,anisotropyMap:$,clearcoat:Y,clearcoatMap:J,clearcoatNormalMap:ee,clearcoatRoughnessMap:te,iridescence:K,iridescenceMap:re,iridescenceThicknessMap:ie,sheen:Z,sheenColorMap:ne,sheenRoughnessMap:se,specularMap:ae,specularColorMap:oe,specularIntensityMap:le,transmission:Q,transmissionMap:he,thicknessMap:ue,gradientMap:ce,opaque:!1===s.transparent&&1===s.blending,alphaMap:de,alphaTest:pe,alphaHash:me,combine:s.combine,mapUv:F&&_(s.map.channel),aoMapUv:B&&_(s.aoMap.channel),lightMapUv:G&&_(s.lightMap.channel),bumpMapUv:z&&_(s.bumpMap.channel),normalMapUv:H&&_(s.normalMap.channel),displacementMapUv:W&&_(s.displacementMap.channel),emissiveMapUv:V&&_(s.emissiveMap.channel),metalnessMapUv:X&&_(s.metalnessMap.channel),roughnessMapUv:j&&_(s.roughnessMap.channel),anisotropyMapUv:$&&_(s.anisotropyMap.channel),clearcoatMapUv:J&&_(s.clearcoatMap.channel),clearcoatNormalMapUv:ee&&_(s.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:te&&_(s.clearcoatRoughnessMap.channel),iridescenceMapUv:re&&_(s.iridescenceMap.channel),iridescenceThicknessMapUv:ie&&_(s.iridescenceThicknessMap.channel),sheenColorMapUv:ne&&_(s.sheenColorMap.channel),sheenRoughnessMapUv:se&&_(s.sheenRoughnessMap.channel),specularMapUv:ae&&_(s.specularMap.channel),specularColorMapUv:oe&&_(s.specularColorMap.channel),specularIntensityMapUv:le&&_(s.specularIntensityMap.channel),transmissionMapUv:he&&_(s.transmissionMap.channel),thicknessMapUv:ue&&_(s.thicknessMap.channel),alphaMapUv:de&&_(s.alphaMap.channel),vertexTangents:!!T.attributes.tangent&&(H||q),vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!T.attributes.color&&4===T.attributes.color.itemSize,vertexUv1s:_e,vertexUv2s:Ee,vertexUv3s:be,pointsUvs:!0===b.isPoints&&!!T.attributes.uv&&(F||de),fog:!!x,useFog:!1,fogExp2:!1,flatShading:!0===s.flatShading,sizeAttenuation:!0===s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===b.isSkinnedMesh,morphTargets:void 0!==T.morphAttributes.position,morphNormals:void 0!==T.morphAttributes.normal,morphColors:void 0!==T.morphAttributes.color,morphTargetsCount:A,morphTextureStride:P,numDirLights:l.directional.length,numPointLights:l.point.length,numSpotLights:l.spot.length,numSpotLightMaps:l.spotLightMap.length,numRectAreaLights:l.rectArea.length,numHemiLights:l.hemi.length,numDirLightShadows:l.directionalShadowMap.length,numPointLightShadows:l.pointShadowMap.length,numSpotLightShadows:l.spotShadowMap.length,numSpotLightShadowsWithMaps:l.numSpotLightShadowsWithMaps,numLightProbes:l.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:!1,shadowMapType:e.shadowMap.type,toneMapping:xe,useLegacyLights:e._useLegacyLights,decodeVideoTexture:F&&!0===s.map.isVideoTexture&&fe.getTransfer(s.map.colorSpace)===k,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:s.depthPacking>=0,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:ge&&!0===s.extensions.derivatives,extensionFragDepth:ge&&!0===s.extensions.fragDepth,extensionDrawBuffers:ge&&!0===s.extensions.drawBuffers,extensionShaderTextureLOD:ge&&!0===s.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const r=[];if(t.shaderID?r.push(t.shaderID):(r.push(t.customVertexShaderID),r.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)r.push(e),r.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputColorSpace),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.mapUv),e.push(t.alphaMapUv),e.push(t.lightMapUv),e.push(t.aoMapUv),e.push(t.bumpMapUv),e.push(t.normalMapUv),e.push(t.displacementMapUv),e.push(t.emissiveMapUv),e.push(t.metalnessMapUv),e.push(t.roughnessMapUv),e.push(t.anisotropyMapUv),e.push(t.clearcoatMapUv),e.push(t.clearcoatNormalMapUv),e.push(t.clearcoatRoughnessMapUv),e.push(t.iridescenceMapUv),e.push(t.iridescenceThicknessMapUv),e.push(t.sheenColorMapUv),e.push(t.sheenRoughnessMapUv),e.push(t.specularMapUv),e.push(t.specularColorMapUv),e.push(t.specularIntensityMapUv),e.push(t.transmissionMapUv),e.push(t.thicknessMapUv),e.push(t.combine),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.numLightProbes),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(r,t),function(e,t){l.disableAll(),t.isWebGL2&&l.enable(0);t.supportsVertexTextures&&l.enable(1);t.instancing&&l.enable(2);t.instancingColor&&l.enable(3);t.matcap&&l.enable(4);t.envMap&&l.enable(5);t.normalMapObjectSpace&&l.enable(6);t.normalMapTangentSpace&&l.enable(7);t.clearcoat&&l.enable(8);t.iridescence&&l.enable(9);t.alphaTest&&l.enable(10);t.vertexColors&&l.enable(11);t.vertexAlphas&&l.enable(12);t.vertexUv1s&&l.enable(13);t.vertexUv2s&&l.enable(14);t.vertexUv3s&&l.enable(15);t.vertexTangents&&l.enable(16);t.anisotropy&&l.enable(17);e.push(l.mask),l.disableAll(),t.fog&&l.enable(0);t.useFog&&l.enable(1);t.flatShading&&l.enable(2);t.logarithmicDepthBuffer&&l.enable(3);t.skinning&&l.enable(4);t.morphTargets&&l.enable(5);t.morphNormals&&l.enable(6);t.morphColors&&l.enable(7);t.premultipliedAlpha&&l.enable(8);t.useLegacyLights&&l.enable(10);t.doubleSided&&l.enable(11);t.flipSided&&l.enable(12);t.useDepthPacking&&l.enable(13);t.dithering&&l.enable(14);t.transmission&&l.enable(15);t.sheen&&l.enable(16);t.opaque&&l.enable(17);t.pointsUvs&&l.enable(18);t.decodeVideoTexture&&l.enable(19);e.push(l.mask)}(r,t),r.push(e.outputColorSpace)),r.push(t.customProgramCacheKey),r.join()},getUniforms:function(e){let t;return t=e.uniforms,t},acquireProgram:function(t,r){let i;for(let e=0,t=u.length;e<t;e++){const t=u[e];if(t.cacheKey===r){i=t,++i.usedTimes;break}}return void 0===i&&(i=new Or(e,r,t,s),u.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=u.indexOf(e);u[t]=u[u.length-1],u.pop(),e.destroy()}},releaseShaderCache:function(e){h.remove(e)},programs:u,dispose:function(){h.dispose()}}}function zr(){let e=new WeakMap;return{get:function(t){let r=e.get(t);return void 0===r&&(r={},e.set(t,r)),r},remove:function(t){e.delete(t)},update:function(t,r,i){e.get(t)[r]=i},dispose:function(){e=new WeakMap}}}function Hr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function kr(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Wr(){const e=[];let t=0;const r=[],i=[],n=[];function s(r,i,n,s,a,o){let l=e[t];return void 0===l?(l={id:r.id,object:r,geometry:i,material:n,groupOrder:s,renderOrder:r.renderOrder,z:a,group:o},e[t]=l):(l.id=r.id,l.object=r,l.geometry=i,l.material=n,l.groupOrder=s,l.renderOrder=r.renderOrder,l.z=a,l.group=o),t++,l}return{opaque:r,transmissive:i,transparent:n,init:function(){t=0,r.length=0,i.length=0,n.length=0},push:function(e,t,a,o,l,h){const u=s(e,t,a,o,l,h);a.transmission>0?i.push(u):!0===a.transparent?n.push(u):r.push(u)},unshift:function(e,t,a,o,l,h){const u=s(e,t,a,o,l,h);a.transmission>0?i.unshift(u):!0===a.transparent?n.unshift(u):r.unshift(u)},finish:function(){for(let r=t,i=e.length;r<i;r++){const t=e[r];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){r.length>1&&r.sort(e||Hr),i.length>1&&i.sort(t||kr),n.length>1&&n.sort(t||kr)}}}function Vr(){let e=new WeakMap;return{get:function(t,r){const i=e.get(t);let n;return void 0===i?(n=new Wr,e.set(t,[n])):r>=i.length?(n=new Wr,i.push(n)):n=i[r],n},dispose:function(){e=new WeakMap}}}function Xr(){const e={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)e.probe.push(new Ae);return{setup:function(e){},setupView:function(e,t){},state:e}}function jr(e,t){const r=new Xr(e,t),i=[],n=[];return{init:function(){i.length=0,n.length=0},state:{lightsArray:i,shadowsArray:n,lights:r},setupLights:function(e){r.setup(i,e)},setupLightsView:function(e){r.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){n.push(e)}}}function qr(e,t){let r=new WeakMap;return{get:function(i,n=0){const s=r.get(i);let a;return void 0===s?(a=new jr(e,t),r.set(i,[a])):n>=s.length?(a=new jr(e,t),s.push(a)):a=s[n],a},dispose:function(){r=new WeakMap}}}function Yr(e,t,r){}function Kr(e,t,i){const n=i.isWebGL2;const s=new function(){let t=!1;const r=new ve;let i=null;const n=new ve(0,0,0,0);return{setMask:function(r){i===r||t||(e.colorMask(r,r,r,r),i=r)},setLocked:function(e){t=e},setClear:function(t,i,s,a,o){!0===o&&(t*=a,i*=a,s*=a),r.set(t,i,s,a),!1===n.equals(r)&&(e.clearColor(t,i,s,a),n.copy(r))},reset:function(){t=!1,i=null,n.set(-1,0,0,0)}}},a=new function(){let t=!1,r=null,i=null,n=null;return{setTest:function(t){t?H(e.DEPTH_TEST):k(e.DEPTH_TEST)},setMask:function(i){r===i||t||(e.depthMask(i),r=i)},setFunc:function(t){if(i!==t){switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:default:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL)}i=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,r=null,i=null,n=null}}},o=new function(){let t=!1,r=null,i=null,n=null,s=null,a=null,o=null,l=null,h=null;return{setTest:function(r){t||(r?H(e.STENCIL_TEST):k(e.STENCIL_TEST))},setMask:function(i){r===i||t||(e.stencilMask(i),r=i)},setFunc:function(t,r,a){i===t&&n===r&&s===a||(e.stencilFunc(t,r,a),i=t,n=r,s=a)},setOp:function(t,r,i){a===t&&o===r&&l===i||(e.stencilOp(t,r,i),a=t,o=r,l=i)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,r=null,i=null,n=null,s=null,a=null,o=null,l=null,h=null}}},l=new WeakMap,h=new WeakMap;let u={},c={},d=new WeakMap,p=[],f=null,m=!1,g=null,_=null,E=null,b=null,x=null,T=null,y=null,v=!1,M=null,S=null,R=null,A=null,w=null;const C=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let L=!1,D=0;const P=e.getParameter(e.VERSION);-1!==P.indexOf("WebGL")?(D=parseFloat(/^WebGL (\d)/.exec(P)[1]),L=D>=1):-1!==P.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),L=D>=2);let U=null,F={};const O=e.getParameter(e.SCISSOR_BOX),I=e.getParameter(e.VIEWPORT),B=(new ve).fromArray(O),N=(new ve).fromArray(I);function G(t,r,i,s){const a=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let o=0;o<i;o++)!n||t!==e.TEXTURE_3D&&t!==e.TEXTURE_2D_ARRAY?e.texImage2D(r+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,a):e.texImage3D(r,0,e.RGBA,1,1,s,0,e.RGBA,e.UNSIGNED_BYTE,a);return o}const z={};function H(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function k(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}z[e.TEXTURE_2D]=G(e.TEXTURE_2D,e.TEXTURE_2D,1),z[e.TEXTURE_CUBE_MAP]=G(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(z[e.TEXTURE_2D_ARRAY]=G(e.TEXTURE_2D_ARRAY,e.TEXTURE_2D_ARRAY,1,1),z[e.TEXTURE_3D]=G(e.TEXTURE_3D,e.TEXTURE_3D,1,1)),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),H(e.DEPTH_TEST),a.setFunc(3),j(!1),q(1),H(e.CULL_FACE),X(0);const W={[r]:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT};if(n)W[103]=e.MIN,W[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(W[103]=e.MIN_EXT,W[104]=e.MAX_EXT)}const V={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,204:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,205:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA};function X(t,i,n,s,a,o,l,h){if(0!==t){if(!1===m&&(H(e.BLEND),m=!0),5===t)a=a||i,o=o||n,l=l||s,i===_&&a===x||(e.blendEquationSeparate(W[i],W[a]),_=i,x=a),n===E&&s===b&&o===T&&l===y||(e.blendFuncSeparate(V[n],V[s],V[o],V[l]),E=n,b=s,T=o,y=l),g=t,v=!1;else if(t!==g||h!==v){if(_===r&&x===r||(e.blendEquation(e.FUNC_ADD),_=r,x=r),h)if(1===t)e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);else console.error("THREE.WebGLState: Invalid blending: ",t);else if(1===t)e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);else console.error("THREE.WebGLState: Invalid blending: ",t);E=null,b=null,T=null,y=null,g=t,v=h}}else!0===m&&(k(e.BLEND),m=!1)}function j(t){M!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),M=t)}function q(t){H(e.CULL_FACE),e.cullFace(e.BACK),S=t}function Y(t,r,i){t?(H(e.POLYGON_OFFSET_FILL),A===r&&w===i||(e.polygonOffset(r,i),A=r,w=i)):k(e.POLYGON_OFFSET_FILL)}return{buffers:{color:s,depth:a,stencil:o},enable:H,disable:k,bindFramebuffer:function(t,r){return c[t]!==r&&(e.bindFramebuffer(t,r),c[t]=r,n&&(t===e.DRAW_FRAMEBUFFER&&(c[e.FRAMEBUFFER]=r),t===e.FRAMEBUFFER&&(c[e.DRAW_FRAMEBUFFER]=r)),!0)},drawBuffers:function(r,n){let s=p,a=!1;if(r)if(s=d.get(n),void 0===s&&(s=[],d.set(n,s)),r.isWebGLMultipleRenderTargets){const t=r.texture;if(s.length!==t.length||s[0]!==e.COLOR_ATTACHMENT0){for(let r=0,i=t.length;r<i;r++)s[r]=e.COLOR_ATTACHMENT0+r;s.length=t.length,a=!0}}else s[0]!==e.COLOR_ATTACHMENT0&&(s[0]=e.COLOR_ATTACHMENT0,a=!0);else s[0]!==e.BACK&&(s[0]=e.BACK,a=!0);a&&(i.isWebGL2?e.drawBuffers(s):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(t){return f!==t&&(e.useProgram(t),f=t,!0)},setBlending:X,setMaterial:function(t,r){2===t.side?k(e.CULL_FACE):H(e.CULL_FACE);let i=1===t.side;r&&(i=!i),j(i),1===t.blending&&!1===t.transparent?X(0):X(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),s.setMask(t.colorWrite);const n=t.stencilWrite;o.setTest(n),n&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Y(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?H(e.SAMPLE_ALPHA_TO_COVERAGE):k(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:j,setCullFace:q,setLineWidth:function(t){t!==R&&(L&&e.lineWidth(t),R=t)},setPolygonOffset:Y,setScissorTest:function(t){t?H(e.SCISSOR_TEST):k(e.SCISSOR_TEST)},activeTexture:function(t){void 0===t&&(t=e.TEXTURE0+C-1),U!==t&&(e.activeTexture(t),U=t)},bindTexture:function(t,r,i){void 0===i&&(i=null===U?e.TEXTURE0+C-1:U);let n=F[i];void 0===n&&(n={type:void 0,texture:void 0},F[i]=n),n.type===t&&n.texture===r||(U!==i&&(e.activeTexture(i),U=i),e.bindTexture(t,r||z[t]),n.type=t,n.texture=r)},unbindTexture:function(){const t=F[U];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexImage3D:function(){try{e.compressedTexImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,r){let i=h.get(r);void 0===i&&(i=new WeakMap,h.set(r,i));let n=i.get(t);void 0===n&&(n=e.getUniformBlockIndex(r,t.name),i.set(t,n))},uniformBlockBinding:function(t,r){const i=h.get(r).get(t);l.get(r)!==i&&(e.uniformBlockBinding(r,i,t.__bindingPointIndex),l.set(r,i))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage3D:function(){try{e.compressedTexSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===B.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),B.copy(t))},viewport:function(t){!1===N.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),N.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===n&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),u={},U=null,F={},c={},d=new WeakMap,p=[],f=null,m=!1,g=null,_=null,E=null,b=null,x=null,T=null,y=null,v=!1,M=null,S=null,R=null,A=null,w=null,B.set(0,0,e.canvas.width,e.canvas.height),N.set(0,0,e.canvas.width,e.canvas.height),s.reset(),a.reset(),o.reset()}}}function Zr(e,t,r,i,n,s,a){const o=n.isWebGL2,l=n.maxTextures,h=n.maxTextureSize,u=n.maxSamples,c=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,d="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let f;const y=new WeakMap;let L=!1;try{L="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function D(e,t){return L?new OffscreenCanvas(e,t):he("canvas")}function P(e){return re(e.width)&&re(e.height)}function U(e,t){return e.generateMipmaps&&t&&e.minFilter!==g&&e.minFilter!==E}function F(t){e.generateMipmap(t)}function O(r,i,n,s,a=!1){if(!1===o)return i;if(null!==r){if(void 0!==e[r])return e[r];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+r+"'")}let l=i;if(i===e.RED&&(n===e.FLOAT&&(l=e.R32F),n===e.HALF_FLOAT&&(l=e.R16F),n===e.UNSIGNED_BYTE&&(l=e.R8)),i===e.RED_INTEGER&&(n===e.UNSIGNED_BYTE&&(l=e.R8UI),n===e.UNSIGNED_SHORT&&(l=e.R16UI),n===e.UNSIGNED_INT&&(l=e.R32UI),n===e.BYTE&&(l=e.R8I),n===e.SHORT&&(l=e.R16I),n===e.INT&&(l=e.R32I)),i===e.RG&&(n===e.FLOAT&&(l=e.RG32F),n===e.HALF_FLOAT&&(l=e.RG16F),n===e.UNSIGNED_BYTE&&(l=e.RG8)),i===e.RGBA){const t=a?H:fe.getTransfer(s);n===e.FLOAT&&(l=e.RGBA32F),n===e.HALF_FLOAT&&(l=e.RGBA16F),n===e.UNSIGNED_BYTE&&(l=t===k?e.SRGB8_ALPHA8:e.RGBA8),n===e.UNSIGNED_SHORT_4_4_4_4&&(l=e.RGBA4),n===e.UNSIGNED_SHORT_5_5_5_1&&(l=e.RGB5_A1)}return l!==e.R16F&&l!==e.R32F&&l!==e.RG16F&&l!==e.RG32F&&l!==e.RGBA16F&&l!==e.RGBA32F||t.get("EXT_color_buffer_float"),l}function B(t){return t===g||1004===t||t===_?e.NEAREST:e.LINEAR}function G(e){const t=e.target;t.removeEventListener("dispose",G),function(e){const t=i.get(e);if(void 0===t.__webglInit)return;const r=e.source,n=y.get(r);if(n){const i=n[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&W(e),0===Object.keys(n).length&&y.delete(r)}i.remove(e)}(t),t.isVideoTexture&&p.delete(t)}function z(t){const r=t.target;r.removeEventListener("dispose",z),function(t){const r=t.texture,n=i.get(t),s=i.get(r);void 0!==s.__webglTexture&&(e.deleteTexture(s.__webglTexture),a.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++){if(Array.isArray(n.__webglFramebuffer[t]))for(let r=0;r<n.__webglFramebuffer[t].length;r++)e.deleteFramebuffer(n.__webglFramebuffer[t][r]);else e.deleteFramebuffer(n.__webglFramebuffer[t]);n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[t])}else{if(Array.isArray(n.__webglFramebuffer))for(let t=0;t<n.__webglFramebuffer.length;t++)e.deleteFramebuffer(n.__webglFramebuffer[t]);else e.deleteFramebuffer(n.__webglFramebuffer);if(n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer)for(let t=0;t<n.__webglColorRenderbuffer.length;t++)n.__webglColorRenderbuffer[t]&&e.deleteRenderbuffer(n.__webglColorRenderbuffer[t]);n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(let t=0,n=r.length;t<n;t++){const n=i.get(r[t]);n.__webglTexture&&(e.deleteTexture(n.__webglTexture),a.memory.textures--),i.remove(r[t])}i.remove(r),i.remove(t)}(r)}function W(t){const r=i.get(t);e.deleteTexture(r.__webglTexture);const n=t.source;delete y.get(n)[r.__cacheKey],a.memory.textures--}let V=0;function X(t,n){const s=i.get(t);if(t.isVideoTexture&&function(e){const t=a.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&s.__version!==t.version){const e=t.image;if(null===e)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==e.complete)return void Q(s,t,n);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.bindTexture(e.TEXTURE_2D,s.__webglTexture,e.TEXTURE0+n)}const j={1e3:e.REPEAT,[m]:e.CLAMP_TO_EDGE,1002:e.MIRRORED_REPEAT},Y={[g]:e.NEAREST,1004:e.NEAREST_MIPMAP_NEAREST,[_]:e.NEAREST_MIPMAP_LINEAR,[E]:e.LINEAR,1007:e.LINEAR_MIPMAP_NEAREST,[b]:e.LINEAR_MIPMAP_LINEAR},K={512:e.NEVER,519:e.ALWAYS,513:e.LESS,515:e.LEQUAL,514:e.EQUAL,518:e.GEQUAL,516:e.GREATER,517:e.NOTEQUAL};function Z(r,s,a){if(a?(e.texParameteri(r,e.TEXTURE_WRAP_S,j[s.wrapS]),e.texParameteri(r,e.TEXTURE_WRAP_T,j[s.wrapT]),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,j[s.wrapR]),e.texParameteri(r,e.TEXTURE_MAG_FILTER,Y[s.magFilter]),e.texParameteri(r,e.TEXTURE_MIN_FILTER,Y[s.minFilter])):(e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),r!==e.TEXTURE_3D&&r!==e.TEXTURE_2D_ARRAY||e.texParameteri(r,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),s.wrapS===m&&s.wrapT===m||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(r,e.TEXTURE_MAG_FILTER,B(s.magFilter)),e.texParameteri(r,e.TEXTURE_MIN_FILTER,B(s.minFilter)),s.minFilter!==g&&s.minFilter!==E&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),s.compareFunction&&(e.texParameteri(r,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE),e.texParameteri(r,e.TEXTURE_COMPARE_FUNC,K[s.compareFunction])),!0===t.has("EXT_texture_filter_anisotropic")){const a=t.get("EXT_texture_filter_anisotropic");if(s.magFilter===g)return;if(s.minFilter!==_&&s.minFilter!==b)return;if(s.type===M&&!1===t.has("OES_texture_float_linear"))return;if(!1===o&&s.type===S&&!1===t.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(e.texParameterf(r,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,n.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function Q(n,l,u){let c=e.TEXTURE_2D;(l.isDataArrayTexture||l.isCompressedArrayTexture)&&(c=e.TEXTURE_2D_ARRAY),l.isData3DTexture&&(c=e.TEXTURE_3D);const d=function(t,r){let i=!1;void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",G));const n=r.source;let s=y.get(n);void 0===s&&(s={},y.set(n,s));const o=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.wrapR||0),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.colorSpace),t.join()}(r);if(o!==t.__cacheKey){void 0===s[o]&&(s[o]={texture:e.createTexture(),usedTimes:0},a.memory.textures++,i=!0),s[o].usedTimes++;const n=s[t.__cacheKey];void 0!==n&&(s[t.__cacheKey].usedTimes--,0===n.usedTimes&&W(r)),t.__cacheKey=o,t.__webglTexture=s[o].texture}return i}(n,l),p=l.source;r.bindTexture(c,n.__webglTexture,e.TEXTURE0+u);const _=i.get(p);if(p.version!==_.__version||!0===d){r.activeTexture(e.TEXTURE0+u);const i=fe.getPrimaries(fe.workingColorSpace),n=l.colorSpace===I?null:fe.getPrimaries(l.colorSpace),a=l.colorSpace===I||i===n?e.NONE:e.BROWSER_DEFAULT_WEBGL;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,l.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,l.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,a);const b=function(e){return!o&&(e.wrapS!==m||e.wrapT!==m||e.minFilter!==g&&e.minFilter!==E)}(l)&&!1===P(l.image);let y=function(e,t,r,i){let n=1;if((e.width>i||e.height>i)&&(n=i/Math.max(e.width,e.height)),n<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?ie:Math.floor,s=i(n*e.width),a=i(n*e.height);void 0===f&&(f=D(s,a));const o=r?D(s,a):f;return o.width=s,o.height=a,o.getContext("2d").drawImage(e,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+s+"x"+a+")."),o}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}(l.image,b,!1,h);y=function(e,r){const i=e.colorSpace,n=e.format,s=e.type;if(!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===q)return r;i!==N&&i!==I&&(fe.getTransfer(i)===k?!1===o?!0===t.has("EXT_sRGB")&&n===A?(e.format=q,e.minFilter=E,e.generateMipmaps=!1):r=Ee.sRGBToLinear(r):n===A&&s===x||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i));return r}(l,y);const S=P(y)||o,L=s.convert(l.format,l.colorSpace);let B,G=s.convert(l.type),z=O(l.internalFormat,L,G,l.colorSpace,l.isVideoTexture);Z(c,l,S);const H=l.mipmaps,W=o&&!0!==l.isVideoTexture,V=void 0===_.__version||!0===d,X=function(e,t,r){return!0===U(e,r)||e.isFramebufferTexture&&e.minFilter!==g&&e.minFilter!==E?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}(l,y,S);if(l.isDepthTexture)z=e.DEPTH_COMPONENT,o?z=l.type===M?e.DEPTH_COMPONENT32F:l.type===v?e.DEPTH_COMPONENT24:l.type===R?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:l.type===M&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),l.format===w&&z===e.DEPTH_COMPONENT&&l.type!==T&&l.type!==v&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),l.type=v,G=s.convert(l.type)),l.format===C&&z===e.DEPTH_COMPONENT&&(z=e.DEPTH_STENCIL,l.type!==R&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),l.type=R,G=s.convert(l.type))),V&&(W?r.texStorage2D(e.TEXTURE_2D,1,z,y.width,y.height):r.texImage2D(e.TEXTURE_2D,0,z,y.width,y.height,0,L,G,null));else if(l.isDataTexture)if(H.length>0&&S){W&&V&&r.texStorage2D(e.TEXTURE_2D,X,z,H[0].width,H[0].height);for(let t=0,i=H.length;t<i;t++)B=H[t],W?r.texSubImage2D(e.TEXTURE_2D,t,0,0,B.width,B.height,L,G,B.data):r.texImage2D(e.TEXTURE_2D,t,z,B.width,B.height,0,L,G,B.data);l.generateMipmaps=!1}else W?(V&&r.texStorage2D(e.TEXTURE_2D,X,z,y.width,y.height),r.texSubImage2D(e.TEXTURE_2D,0,0,0,y.width,y.height,L,G,y.data)):r.texImage2D(e.TEXTURE_2D,0,z,y.width,y.height,0,L,G,y.data);else if(l.isCompressedTexture)if(l.isCompressedArrayTexture){W&&V&&r.texStorage3D(e.TEXTURE_2D_ARRAY,X,z,H[0].width,H[0].height,y.depth);for(let t=0,i=H.length;t<i;t++)B=H[t],l.format!==A?null!==L?W?r.compressedTexSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,B.width,B.height,y.depth,L,B.data,0,0):r.compressedTexImage3D(e.TEXTURE_2D_ARRAY,t,z,B.width,B.height,y.depth,0,B.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):W?r.texSubImage3D(e.TEXTURE_2D_ARRAY,t,0,0,0,B.width,B.height,y.depth,L,G,B.data):r.texImage3D(e.TEXTURE_2D_ARRAY,t,z,B.width,B.height,y.depth,0,L,G,B.data)}else{W&&V&&r.texStorage2D(e.TEXTURE_2D,X,z,H[0].width,H[0].height);for(let t=0,i=H.length;t<i;t++)B=H[t],l.format!==A?null!==L?W?r.compressedTexSubImage2D(e.TEXTURE_2D,t,0,0,B.width,B.height,L,B.data):r.compressedTexImage2D(e.TEXTURE_2D,t,z,B.width,B.height,0,B.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):W?r.texSubImage2D(e.TEXTURE_2D,t,0,0,B.width,B.height,L,G,B.data):r.texImage2D(e.TEXTURE_2D,t,z,B.width,B.height,0,L,G,B.data)}else if(l.isDataArrayTexture)W?(V&&r.texStorage3D(e.TEXTURE_2D_ARRAY,X,z,y.width,y.height,y.depth),r.texSubImage3D(e.TEXTURE_2D_ARRAY,0,0,0,0,y.width,y.height,y.depth,L,G,y.data)):r.texImage3D(e.TEXTURE_2D_ARRAY,0,z,y.width,y.height,y.depth,0,L,G,y.data);else if(l.isData3DTexture)W?(V&&r.texStorage3D(e.TEXTURE_3D,X,z,y.width,y.height,y.depth),r.texSubImage3D(e.TEXTURE_3D,0,0,0,0,y.width,y.height,y.depth,L,G,y.data)):r.texImage3D(e.TEXTURE_3D,0,z,y.width,y.height,y.depth,0,L,G,y.data);else if(l.isFramebufferTexture){if(V)if(W)r.texStorage2D(e.TEXTURE_2D,X,z,y.width,y.height);else{let t=y.width,i=y.height;for(let n=0;n<X;n++)r.texImage2D(e.TEXTURE_2D,n,z,t,i,0,L,G,null),t>>=1,i>>=1}}else if(H.length>0&&S){W&&V&&r.texStorage2D(e.TEXTURE_2D,X,z,H[0].width,H[0].height);for(let t=0,i=H.length;t<i;t++)B=H[t],W?r.texSubImage2D(e.TEXTURE_2D,t,0,0,L,G,B):r.texImage2D(e.TEXTURE_2D,t,z,L,G,B);l.generateMipmaps=!1}else W?(V&&r.texStorage2D(e.TEXTURE_2D,X,z,y.width,y.height),r.texSubImage2D(e.TEXTURE_2D,0,0,0,L,G,y)):r.texImage2D(e.TEXTURE_2D,0,z,L,G,y);U(l,S)&&F(c),_.__version=p.version,l.onUpdate&&l.onUpdate(l)}n.__version=l.version}function $(t,n,a,o,l,h){const u=s.convert(a.format,a.colorSpace),d=s.convert(a.type),p=O(a.internalFormat,u,d,a.colorSpace);if(!i.get(n).__hasExternalTextures){const t=Math.max(1,n.width>>h),i=Math.max(1,n.height>>h);l===e.TEXTURE_3D||l===e.TEXTURE_2D_ARRAY?r.texImage3D(l,h,p,t,i,n.depth,0,u,d,null):r.texImage2D(l,h,p,t,i,0,u,d,null)}r.bindFramebuffer(e.FRAMEBUFFER,t),ne(n)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,o,l,i.get(a).__webglTexture,0,te(n)):(l===e.TEXTURE_2D||l>=e.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=e.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&e.framebufferTexture2D(e.FRAMEBUFFER,o,l,i.get(a).__webglTexture,h),r.bindFramebuffer(e.FRAMEBUFFER,null)}function J(t,r,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),r.depthBuffer&&!r.stencilBuffer){let n=!0===o?e.DEPTH_COMPONENT24:e.DEPTH_COMPONENT16;if(i||ne(r)){const t=r.depthTexture;t&&t.isDepthTexture&&(t.type===M?n=e.DEPTH_COMPONENT32F:t.type===v&&(n=e.DEPTH_COMPONENT24));const i=te(r);ne(r)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,i,n,r.width,r.height):e.renderbufferStorageMultisample(e.RENDERBUFFER,i,n,r.width,r.height)}else e.renderbufferStorage(e.RENDERBUFFER,n,r.width,r.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(r.depthBuffer&&r.stencilBuffer){const n=te(r);i&&!1===ne(r)?e.renderbufferStorageMultisample(e.RENDERBUFFER,n,e.DEPTH24_STENCIL8,r.width,r.height):ne(r)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,n,e.DEPTH24_STENCIL8,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,r.width,r.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=!0===r.isWebGLMultipleRenderTargets?r.texture:[r.texture];for(let n=0;n<t.length;n++){const a=t[n],o=s.convert(a.format,a.colorSpace),l=s.convert(a.type),h=O(a.internalFormat,o,l,a.colorSpace),u=te(r);i&&!1===ne(r)?e.renderbufferStorageMultisample(e.RENDERBUFFER,u,h,r.width,r.height):ne(r)?c.renderbufferStorageMultisampleEXT(e.RENDERBUFFER,u,h,r.width,r.height):e.renderbufferStorage(e.RENDERBUFFER,h,r.width,r.height)}}e.bindRenderbuffer(e.RENDERBUFFER,null)}function ee(t){const n=i.get(t),s=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!n.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(r.bindFramebuffer(e.FRAMEBUFFER,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),X(n.depthTexture,0);const s=i.get(n.depthTexture).__webglTexture,a=te(n);if(n.depthTexture.format===w)ne(n)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,s,0);else{if(n.depthTexture.format!==C)throw new Error("Unknown depthTexture format");ne(n)?c.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0,a):e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,s,0)}}(n.__webglFramebuffer,t)}else if(s){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)r.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=e.createRenderbuffer(),J(n.__webglDepthbuffer[i],t,!1)}else r.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),J(n.__webglDepthbuffer,t,!1);r.bindFramebuffer(e.FRAMEBUFFER,null)}function te(e){return Math.min(u,e.samples)}function ne(e){const r=i.get(e);return o&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==r.__useRenderToTexture}this.allocateTextureUnit=function(){const e=V;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),V+=1,e},this.resetTextureUnits=function(){V=0},this.setTexture2D=X,this.setTexture2DArray=function(t,n){const s=i.get(t);t.version>0&&s.__version!==t.version?Q(s,t,n):r.bindTexture(e.TEXTURE_2D_ARRAY,s.__webglTexture,e.TEXTURE0+n)},this.setTexture3D=function(t,n){const s=i.get(t);t.version>0&&s.__version!==t.version?Q(s,t,n):r.bindTexture(e.TEXTURE_3D,s.__webglTexture,e.TEXTURE0+n)},this.setTextureCube=function(t,n){const s=i.get(t);r.bindTexture(e.TEXTURE_CUBE_MAP,s.__webglTexture,e.TEXTURE0+n)},this.rebindTextures=function(t,r,n){const s=i.get(t);void 0!==r&&$(s.__webglFramebuffer,t,t.texture,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,0),void 0!==n&&ee(t)},this.setupRenderTarget=function(t){const l=t.texture,h=i.get(t),u=i.get(l);t.addEventListener("dispose",z),!0!==t.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=e.createTexture()),u.__version=l.version,a.memory.textures++);const c=!0===t.isWebGLCubeRenderTarget,d=!0===t.isWebGLMultipleRenderTargets,p=P(t)||o;if(c){h.__webglFramebuffer=[];for(let t=0;t<6;t++)if(o&&l.mipmaps&&l.mipmaps.length>0){h.__webglFramebuffer[t]=[];for(let r=0;r<l.mipmaps.length;r++)h.__webglFramebuffer[t][r]=e.createFramebuffer()}else h.__webglFramebuffer[t]=e.createFramebuffer()}else{if(o&&l.mipmaps&&l.mipmaps.length>0){h.__webglFramebuffer=[];for(let t=0;t<l.mipmaps.length;t++)h.__webglFramebuffer[t]=e.createFramebuffer()}else h.__webglFramebuffer=e.createFramebuffer();if(d)if(n.drawBuffers){const r=t.texture;for(let t=0,n=r.length;t<n;t++){const n=i.get(r[t]);void 0===n.__webglTexture&&(n.__webglTexture=e.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&t.samples>0&&!1===ne(t)){const i=d?l:[l];h.__webglMultisampledFramebuffer=e.createFramebuffer(),h.__webglColorRenderbuffer=[],r.bindFramebuffer(e.FRAMEBUFFER,h.__webglMultisampledFramebuffer);for(let r=0;r<i.length;r++){const n=i[r];h.__webglColorRenderbuffer[r]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,h.__webglColorRenderbuffer[r]);const a=s.convert(n.format,n.colorSpace),o=s.convert(n.type),l=O(n.internalFormat,a,o,n.colorSpace,!0===t.isXRRenderTarget),u=te(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,u,l,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+r,e.RENDERBUFFER,h.__webglColorRenderbuffer[r])}e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(h.__webglDepthRenderbuffer=e.createRenderbuffer(),J(h.__webglDepthRenderbuffer,t,!0)),r.bindFramebuffer(e.FRAMEBUFFER,null)}}if(c){r.bindTexture(e.TEXTURE_CUBE_MAP,u.__webglTexture),Z(e.TEXTURE_CUBE_MAP,l,p);for(let r=0;r<6;r++)if(o&&l.mipmaps&&l.mipmaps.length>0)for(let i=0;i<l.mipmaps.length;i++)$(h.__webglFramebuffer[r][i],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,i);else $(h.__webglFramebuffer[r],t,l,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+r,0);U(l,p)&&F(e.TEXTURE_CUBE_MAP),r.unbindTexture()}else if(d){const n=t.texture;for(let s=0,a=n.length;s<a;s++){const a=n[s],o=i.get(a);r.bindTexture(e.TEXTURE_2D,o.__webglTexture),Z(e.TEXTURE_2D,a,p),$(h.__webglFramebuffer,t,a,e.COLOR_ATTACHMENT0+s,e.TEXTURE_2D,0),U(a,p)&&F(e.TEXTURE_2D)}r.unbindTexture()}else{let i=e.TEXTURE_2D;if((t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(o?i=t.isWebGL3DRenderTarget?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),r.bindTexture(i,u.__webglTexture),Z(i,l,p),o&&l.mipmaps&&l.mipmaps.length>0)for(let r=0;r<l.mipmaps.length;r++)$(h.__webglFramebuffer[r],t,l,e.COLOR_ATTACHMENT0,i,r);else $(h.__webglFramebuffer,t,l,e.COLOR_ATTACHMENT0,i,0);U(l,p)&&F(i),r.unbindTexture()}t.depthBuffer&&ee(t)},this.updateRenderTargetMipmap=function(t){const n=P(t)||o,s=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let a=0,o=s.length;a<o;a++){const o=s[a];if(U(o,n)){const n=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=i.get(o).__webglTexture;r.bindTexture(n,s),F(n),r.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(o&&t.samples>0&&!1===ne(t)){const n=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],s=t.width,a=t.height;let o=e.COLOR_BUFFER_BIT;const l=[],h=t.stencilBuffer?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT,u=i.get(t),c=!0===t.isWebGLMultipleRenderTargets;if(c)for(let t=0;t<n.length;t++)r.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,null),r.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,null,0);r.bindFramebuffer(e.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let r=0;r<n.length;r++){l.push(e.COLOR_ATTACHMENT0+r),t.depthBuffer&&l.push(h);const p=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===p&&(t.depthBuffer&&(o|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(o|=e.STENCIL_BUFFER_BIT)),c&&e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,u.__webglColorRenderbuffer[r]),!0===p&&(e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[h]),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,[h])),c){const t=i.get(n[r]).__webglTexture;e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}e.blitFramebuffer(0,0,s,a,0,0,s,a,o,e.NEAREST),d&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,l)}if(r.bindFramebuffer(e.READ_FRAMEBUFFER,null),r.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),c)for(let t=0;t<n.length;t++){r.bindFramebuffer(e.FRAMEBUFFER,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.RENDERBUFFER,u.__webglColorRenderbuffer[t]);const s=i.get(n[t]).__webglTexture;r.bindFramebuffer(e.FRAMEBUFFER,u.__webglFramebuffer),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+t,e.TEXTURE_2D,s,0)}r.bindFramebuffer(e.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=ee,this.setupFrameBufferTexture=$,this.useMultisampledRTT=ne}function Qr(e,t,r){const i=r.isWebGL2;return{convert:function(r,n=""){let s;const a=fe.getTransfer(n);if(r===x)return e.UNSIGNED_BYTE;if(1017===r)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===r)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===r)return e.BYTE;if(1011===r)return e.SHORT;if(r===T)return e.UNSIGNED_SHORT;if(r===y)return e.INT;if(r===v)return e.UNSIGNED_INT;if(r===M)return e.FLOAT;if(r===S)return i?e.HALF_FLOAT:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===r)return e.ALPHA;if(r===A)return e.RGBA;if(1024===r)return e.LUMINANCE;if(1025===r)return e.LUMINANCE_ALPHA;if(r===w)return e.DEPTH_COMPONENT;if(r===C)return e.DEPTH_STENCIL;if(r===q)return s=t.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1028===r)return e.RED;if(1029===r)return e.RED_INTEGER;if(1030===r)return e.RG;if(1031===r)return e.RG_INTEGER;if(1033===r)return e.RGBA_INTEGER;if(r===L||r===D||r===P||r===U)if(a===k){if(s=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(r===L)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===D)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===P)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===U)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(r===L)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===D)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===P)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===U)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===r||35841===r||35842===r||35843===r){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===r)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===r||37496===r){if(s=t.get("WEBGL_compressed_texture_etc"),null===s)return null;if(37492===r)return a===k?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(37496===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r){if(s=t.get("WEBGL_compressed_texture_astc"),null===s)return null;if(37808===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===r)return a===k?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(r===F||36494===r||36495===r){if(s=t.get("EXT_texture_compression_bptc"),null===s)return null;if(r===F)return a===k?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===r)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===r)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===r||36284===r||36285===r||36286===r){if(s=t.get("EXT_texture_compression_rgtc"),null===s)return null;if(r===F)return s.COMPRESSED_RED_RGTC1_EXT;if(36284===r)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===r)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===r)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return r===R?i?e.UNSIGNED_INT_24_8:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==e[r]?e[r]:null}}}function $r(){return{refreshMaterialUniforms(e,t){t.isShaderMaterial&&(t.uniformsNeedUpdate=!1)}}}function Jr(e,t,r,i){let n={},s={},a=[];const o=r.isWebGL2?e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(e,t,r){const i=e.value;if(void 0===r[t]){if("number"==typeof i)r[t]=i;else{const e=Array.isArray(i)?i:[i],n=[];for(let t=0;t<e.length;t++)n.push(e[t].clone());r[t]=n}return!0}if("number"==typeof i){if(r[t]!==i)return r[t]=i,!0}else{const e=Array.isArray(r[t])?r[t]:[r[t]],n=Array.isArray(i)?i:[i];for(let t=0;t<e.length;t++){const r=e[t];if(!1===r.equals(n[t]))return r.copy(n[t]),!0}}return!1}function h(e){const t={boundary:0,storage:0};return"number"==typeof e?(t.boundary=4,t.storage=4):e.isVector2?(t.boundary=8,t.storage=8):e.isVector3||e.isColor?(t.boundary=16,t.storage=12):e.isVector4?(t.boundary=16,t.storage=16):e.isMatrix3?(t.boundary=48,t.storage=48):e.isMatrix4?(t.boundary=64,t.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),t}function u(t){const r=t.target;r.removeEventListener("dispose",u);const i=a.indexOf(r.__bindingPointIndex);a.splice(i,1),e.deleteBuffer(n[r.id]),delete n[r.id],delete s[r.id]}return{bind:function(e,t){const r=t.program;i.uniformBlockBinding(e,r)},update:function(r,c){let d=n[r.id];void 0===d&&(!function(e){const t=e.uniforms;let r=0;const i=16;let n=0;for(let e=0,s=t.length;e<s;e++){const s=t[e],a={boundary:0,storage:0},o=Array.isArray(s.value)?s.value:[s.value];for(let e=0,t=o.length;e<t;e++){const t=h(o[e]);a.boundary+=t.boundary,a.storage+=t.storage}if(s.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=r,e>0){n=r%i;0!==n&&i-n-a.boundary<0&&(r+=i-n,s.__offset=r)}r+=a.storage}n=r%i,n>0&&(r+=i-n);e.__size=r,e.__cache={}}(r),d=function(t){const r=function(){for(let e=0;e<o;e++)if(-1===a.indexOf(e))return a.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=r;const i=e.createBuffer(),n=t.__size,s=t.usage;return e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,n,s),e.bindBuffer(e.UNIFORM_BUFFER,null),e.bindBufferBase(e.UNIFORM_BUFFER,r,i),i}(r),n[r.id]=d,r.addEventListener("dispose",u));const p=c.program;i.updateUBOMapping(r,p);const f=t.render.frame;s[r.id]!==f&&(!function(t){const r=n[t.id],i=t.uniforms,s=t.__cache;e.bindBuffer(e.UNIFORM_BUFFER,r);for(let t=0,r=i.length;t<r;t++){const r=i[t];if(!0===l(r,t,s)){const t=r.__offset,i=Array.isArray(r.value)?r.value:[r.value];let n=0;for(let s=0;s<i.length;s++){const a=i[s],o=h(a);"number"==typeof a?(r.__data[0]=a,e.bufferSubData(e.UNIFORM_BUFFER,t+n,r.__data)):a.isMatrix3?(r.__data[0]=a.elements[0],r.__data[1]=a.elements[1],r.__data[2]=a.elements[2],r.__data[3]=a.elements[0],r.__data[4]=a.elements[3],r.__data[5]=a.elements[4],r.__data[6]=a.elements[5],r.__data[7]=a.elements[0],r.__data[8]=a.elements[6],r.__data[9]=a.elements[7],r.__data[10]=a.elements[8],r.__data[11]=a.elements[0]):(a.toArray(r.__data,n),n+=o.storage/Float32Array.BYTES_PER_ELEMENT)}e.bufferSubData(e.UNIFORM_BUFFER,t,r.__data)}}e.bindBuffer(e.UNIFORM_BUFFER,null)}(r),s[r.id]=f)},dispose:function(){for(const t in n)e.deleteBuffer(n[t]);a=[],n={},s={}}}}const ei={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class ti{constructor(e,t,r){const i=this;let n,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,a,o),s=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return n?n(e):e},this.setURLModifier=function(e){return n=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,r=l.length;t<r;t+=2){const r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}}const ri=new ti;class ii{constructor(e){this.manager=void 0!==e?e:ri,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise((function(i,n){r.load(e,i,t,n)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}ii.DEFAULT_MATERIAL_NAME="__DEFAULT";class ni extends ii{constructor(e){super(e)}load(e,t,r,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const n=this,s=ei.get(e);if(void 0!==s)return n.manager.itemStart(e),setTimeout((function(){t&&t(s),n.manager.itemEnd(e)}),0),s;const a=he("img");function o(){h(),ei.add(e,this),t&&t(this),n.manager.itemEnd(e)}function l(t){h(),i&&i(t),n.manager.itemError(e),n.manager.itemEnd(e)}function h(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),n.manager.itemStart(e),a.src=e,a}}function si(){return("undefined"==typeof performance?Date:performance).now()}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t),e.Clock=class{constructor(){this.elapsedTime=0}getDelta(){let e=0;if(this.running){const t=si();return e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e,e}return this.oldTime=this.startTime=si(),this.elapsedTime=0,this.running=!0,0}},e.Color=at,e.TextureLoader=class extends ii{constructor(e){super(e)}load(e,t,r,i){const n=new ye,s=new ni(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(e,(function(e){n.image=e,n.needsUpdate=!0,void 0!==t&&t(n)}),r,i),n}},e.EquirectangularReflectionMapping=303,e.MathUtils=ne,e.Object3D=tt,e.PerspectiveCamera=At,e.Scene=class extends tt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}},e.WebGLRenderer=class{constructor(e={}){const{canvas:r=ue(),context:i=null,depth:n=!0,stencil:s=!0,alpha:o=!1,antialias:l=!1,premultipliedAlpha:h=!0,preserveDrawingBuffer:u=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:d=!1}=e;let p;this.isWebGLRenderer=!0,p=null!==i?i.getContextAttributes().alpha:o;const f=new Uint32Array(4),m=new Int32Array(4);let g=null,_=null;const E=[],y=[];this.domElement=r,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=B,this._useLegacyLights=!1,this.toneMapping=a,this.toneMappingExposure=1;const w=this;let C=!1,L=0,D=0,P=null,U=-1,F=null;const O=new ve,I=new ve;let G=null;const z=new at(0);let H=0,k=r.width,W=r.height,V=1,X=null,j=null;const q=new ve(0,0,k,W),Y=new ve(0,0,k,W);let K=!1;const Z=new Bt;let Q=!1,$=!1,J=null;const ee=new Fe,te=new se,re=new Ae,ne={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ae(){return null===P?V:1}let oe,le,he,ce,de,pe,fe,me,ge,_e,Ee,be,xe,Te,ye,Me,Re,we,Ce,Le,De,Pe,Ue,Oe=i;function Ie(e,t){for(let i=0;i<e.length;i++){const n=e[i],s=r.getContext(n,t);if(null!==s)return s}return null}try{const e={alpha:!0,depth:n,stencil:s,antialias:l,premultipliedAlpha:h,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:d};if("setAttribute"in r&&r.setAttribute("data-engine",`three.js r${t}`),r.addEventListener("webglcontextlost",Ne,!1),r.addEventListener("webglcontextrestored",Ge,!1),r.addEventListener("webglcontextcreationerror",ze,!1),null===Oe){const t=["webgl2","webgl","experimental-webgl"];if(Oe=Ie(t,e),null===Oe)throw Ie(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&Oe instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),void 0===Oe.getShaderPrecisionFormat&&(Oe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function Be(){oe=new $t(Oe),le=new Yt(Oe,oe,e),oe.init(le),De=new Qr(Oe,oe,le),he=new Kr(Oe,oe,le),ce=new tr(Oe),de=new zr,pe=new Zr(Oe,oe,he,de,le,De,ce),fe=new Zt(w),me=new Qt(w),ge=new Gt(Oe,le),Pe=new jt(Oe,oe,ge,le),_e=new Jt(Oe,ge,ce,Pe),Ee=new rr(Oe,_e,ge,ce),Me=new Kt(de),be=new Gr(w,fe,me,oe,le,Pe,Me),xe=new $r(w,de),Te=new Vr,ye=new qr(oe,le),we=new Xt(w,fe,me,he,Ee,p,h),Re=new Yr(w,Ee,le),Ue=new Jr(Oe,ce,le,he),Ce=new qt(Oe,oe,ce,le),Le=new er(Oe,oe,ce,le),ce.programs=be.programs,w.capabilities=le,w.extensions=oe,w.properties=de,w.renderLists=Te,w.shadowMap=Re,w.state=he,w.info=ce}function Ne(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),C=!0}function Ge(){console.log("THREE.WebGLRenderer: Context Restored."),C=!1;const e=ce.autoReset,t=Re.autoUpdate,r=Re.needsUpdate,i=Re.type;Be(),ce.autoReset=e,Re.enabled=!1,Re.autoUpdate=t,Re.needsUpdate=r,Re.type=i}function ze(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function He(e){const t=e.target;t.removeEventListener("dispose",He),function(e){(function(e){const t=de.get(e).programs;void 0!==t&&(t.forEach((function(e){be.releaseProgram(e)})),e.isShaderMaterial&&be.releaseShaderCache(e))})(e),de.remove(e)}(t)}Be(),this.xr=null,this.getContext=function(){return Oe},this.getContextAttributes=function(){return Oe.getContextAttributes()},this.forceContextLoss=function(){const e=oe.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=oe.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(e){void 0!==e&&(V=e,this.setSize(k,W,!1))},this.getSize=function(e){return e.set(k,W)},this.setSize=function(e,t,i=!0){k=e,W=t,r.width=Math.floor(e*V),r.height=Math.floor(t*V),!0===i&&(r.style.width=e+"px",r.style.height=t+"px"),this.setViewport(0,0,e,t)},this.getDrawingBufferSize=function(e){return e.set(k*V,W*V).floor()},this.setDrawingBufferSize=function(e,t,i){k=e,W=t,V=i,r.width=Math.floor(e*i),r.height=Math.floor(t*i),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(O)},this.getViewport=function(e){return e.copy(q)},this.setViewport=function(e,t,r,i){e.isVector4?q.set(e.x,e.y,e.z,e.w):q.set(e,t,r,i),he.viewport(O.copy(q).multiplyScalar(V).floor())},this.getScissor=function(e){return e.copy(Y)},this.setScissor=function(e,t,r,i){e.isVector4?Y.set(e.x,e.y,e.z,e.w):Y.set(e,t,r,i),he.scissor(I.copy(Y).multiplyScalar(V).floor())},this.getScissorTest=function(){return K},this.setScissorTest=function(e){he.setScissorTest(K=e)},this.setOpaqueSort=function(e){X=e},this.setTransparentSort=function(e){j=e},this.getClearColor=function(e){return e.copy(we.getClearColor())},this.setClearColor=function(){we.setClearColor.apply(we,arguments)},this.getClearAlpha=function(){return we.getClearAlpha()},this.setClearAlpha=function(){we.setClearAlpha.apply(we,arguments)},this.clear=function(e=!0,t=!0,r=!0){let i=0;if(e){let e=!1;if(null!==P){const t=P.texture.format;e=1033===t||1031===t||1029===t}if(e){const e=P.texture.type,t=e===x||e===v||e===T||e===R||1017===e||1018===e,r=we.getClearColor(),i=we.getClearAlpha(),n=r.r,s=r.g,a=r.b;t?(f[0]=n,f[1]=s,f[2]=a,f[3]=i,Oe.clearBufferuiv(Oe.COLOR,0,f)):(m[0]=n,m[1]=s,m[2]=a,m[3]=i,Oe.clearBufferiv(Oe.COLOR,0,m))}else i|=Oe.COLOR_BUFFER_BIT}t&&(i|=Oe.DEPTH_BUFFER_BIT),r&&(i|=Oe.STENCIL_BUFFER_BIT),Oe.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){r.removeEventListener("webglcontextlost",Ne,!1),r.removeEventListener("webglcontextrestored",Ge,!1),r.removeEventListener("webglcontextcreationerror",ze,!1),Te.dispose(),ye.dispose(),de.dispose(),fe.dispose(),me.dispose(),Ee.dispose(),Pe.dispose(),Ue.dispose(),be.dispose(),xr.dispose(),xr.removeEventListener("sessionstart",We),xr.removeEventListener("sessionend",Ve),J&&(J.dispose(),J=null),Xe.stop()},this.renderBufferDirect=function(e,t,r,i,n,s){null===t&&(t=ne);const o=n.isMesh&&n.matrixWorld.determinant()<0,l=function(e,t,r,i,n){!0!==t.isScene&&(t=ne);pe.resetTextureUnits();const s=t.fog,o=i.isMeshStandardMaterial?t.environment:null,l=null===P?w.outputColorSpace:!0===P.isXRRenderTarget?P.texture.colorSpace:N,h=(i.isMeshStandardMaterial?me:fe).get(i.envMap||o),u=!0===i.vertexColors&&!!r.attributes.color&&4===r.attributes.color.itemSize,c=!!r.attributes.tangent&&(!!i.normalMap||i.anisotropy>0),d=!!r.morphAttributes.position,p=!!r.morphAttributes.normal,f=!!r.morphAttributes.color;let m=a;i.toneMapped&&(null!==P&&!0!==P.isXRRenderTarget||(m=w.toneMapping));const g=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,E=void 0!==g?g.length:0,b=de.get(i),x=_.state.lights;if(!0===Q&&(!0===$||e!==F)){const t=e===F&&i.id===U;Me.setState(i,e,t)}let T=!1;i.version===b.__version?b.needsLights&&b.lightsStateVersion!==x.state.version||b.outputColorSpace!==l||!0===b.instancing||n.isSkinnedMesh&&!1===b.skinning?T=!0:n.isSkinnedMesh||!0!==b.skinning?b.envMap!==h||!0===i.fog&&b.fog!==s?T=!0:void 0===b.numClippingPlanes||b.numClippingPlanes===Me.numPlanes&&b.numIntersection===Me.numIntersection?(b.vertexAlphas!==u||b.vertexTangents!==c||b.morphTargets!==d||b.morphNormals!==p||b.morphColors!==f||b.toneMapping!==m||!0===le.isWebGL2&&b.morphTargetsCount!==E)&&(T=!0):T=!0:T=!0:(T=!0,b.__version=i.version);let y=b.currentProgram;!0===T&&(y=Ze(i,t,n));let v=!1,M=!1,S=!1;const R=y.getUniforms(),A=b.uniforms;he.useProgram(y.program)&&(v=!0,M=!0,S=!0);i.id!==U&&(U=i.id,M=!0);if(v||F!==e){R.setValue(Oe,"projectionMatrix",e.projectionMatrix),R.setValue(Oe,"viewMatrix",e.matrixWorldInverse);const t=R.map.cameraPosition;void 0!==t&&t.setValue(Oe,re.setFromMatrixPosition(e.matrixWorld)),le.logarithmicDepthBuffer&&R.setValue(Oe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&R.setValue(Oe,"isOrthographic",!0===e.isOrthographicCamera),F!==e&&(F=e,M=!0,S=!0)}if(n.isSkinnedMesh){R.setOptional(Oe,n,"bindMatrix"),R.setOptional(Oe,n,"bindMatrixInverse");const e=n.skeleton;e&&(le.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),R.setValue(Oe,"boneTexture",e.boneTexture,pe),R.setValue(Oe,"boneTextureSize",e.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}(M||b.receiveShadow!==n.receiveShadow)&&(b.receiveShadow=n.receiveShadow,R.setValue(Oe,"receiveShadow",n.receiveShadow));i.isMeshGouraudMaterial&&null!==i.envMap&&(A.envMap.value=h,A.flipEnvMap.value=h.isCubeTexture&&!1===h.isRenderTargetTexture?-1:1);M&&(R.setValue(Oe,"toneMappingExposure",w.toneMappingExposure),b.needsLights&&(L=S,(C=A).ambientLightColor.needsUpdate=L,C.lightProbe.needsUpdate=L,C.directionalLights.needsUpdate=L,C.directionalLightShadows.needsUpdate=L,C.pointLights.needsUpdate=L,C.pointLightShadows.needsUpdate=L,C.spotLights.needsUpdate=L,C.spotLightShadows.needsUpdate=L,C.rectAreaLights.needsUpdate=L,C.hemisphereLights.needsUpdate=L),xe.refreshMaterialUniforms(A,i,V,W,J),_r.upload(Oe,b.uniformsList,A,pe));var C,L;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(_r.upload(Oe,b.uniformsList,A,pe),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&R.setValue(Oe,"center",n.center);if(R.setValue(Oe,"modelViewMatrix",n.modelViewMatrix),R.setValue(Oe,"normalMatrix",n.normalMatrix),R.setValue(Oe,"modelMatrix",n.matrixWorld),i.isShaderMaterial||i.isRawShaderMaterial){const e=i.uniformsGroups;for(let t=0,r=e.length;t<r;t++)if(le.isWebGL2){const r=e[t];Ue.update(r,y),Ue.bind(r,y)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return y}(e,t,r,i,n);he.setMaterial(i,o);let h=r.index,u=1;if(!0===i.wireframe){if(h=_e.getWireframeAttribute(r),void 0===h)return;u=2}const c=r.drawRange,d=r.attributes.position;let p=c.start*u,f=(c.start+c.count)*u;null!==s&&(p=Math.max(p,s.start*u),f=Math.min(f,(s.start+s.count)*u)),null!==h?(p=Math.max(p,0),f=Math.min(f,h.count)):null!=d&&(p=Math.max(p,0),f=Math.min(f,d.count));const m=f-p;if(m<0||m===1/0)return;let g;Pe.setup(n,i,l,r,h);let E=Ce;if(null!==h&&(g=ge.get(h),E=Le,E.setIndex(g)),n.isMesh)!0===i.wireframe?(he.setLineWidth(i.wireframeLinewidth*ae()),E.setMode(Oe.LINES)):E.setMode(Oe.TRIANGLES);else if(n.isLine){let e=i.linewidth;void 0===e&&(e=1),he.setLineWidth(e*ae()),n.isLineSegments?E.setMode(Oe.LINES):n.isLineLoop?E.setMode(Oe.LINE_LOOP):E.setMode(Oe.LINE_STRIP)}else n.isPoints?E.setMode(Oe.POINTS):n.isSprite&&E.setMode(Oe.TRIANGLES);E.render(p,m)},this.compile=function(e,t){function r(e,t,r){!0===e.transparent&&2===e.side&&!1===e.forceSinglePass?(e.side=1,e.needsUpdate=!0,Ze(e,t,r),e.side=0,e.needsUpdate=!0,Ze(e,t,r),e.side=2):Ze(e,t,r)}_=ye.get(e),_.init(),y.push(_),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(_.pushLight(e),e.castShadow&&_.pushShadow(e))})),_.setupLights(w._useLegacyLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){r(i[n],e,t)}else r(i,e,t)})),y.pop(),_=null};let ke=null;function We(){Xe.stop()}function Ve(){Xe.start()}const Xe=new Nt;function je(e,t,r,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)r=e.renderOrder;else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||Z.intersectsObject(e))){const t=Ee.update(e),n=e.material;if(i&&(void 0!==e.boundingSphere?(null===e.boundingSphere&&e.computeBoundingSphere(),re.copy(e.boundingSphere.center)):(null===t.boundingSphere&&t.computeBoundingSphere(),re.copy(t.boundingSphere.center)),re.applyMatrix4(e.matrixWorld).applyMatrix4(ee)),Array.isArray(n)){const i=t.groups;for(let s=0,a=i.length;s<a;s++){const a=i[s],o=n[a.materialIndex];o&&o.visible&&g.push(e,t,o,r,re.z,a)}}else n.visible&&g.push(e,t,n,r,re.z,null)}const n=e.children;for(let e=0,s=n.length;e<s;e++)je(n[e],t,r,i)}function qe(e,t,r,i){const n=e.opaque,s=e.transmissive,o=e.transparent;_.setupLightsView(r),!0===Q&&Me.setGlobalState(w.clippingPlanes,r),s.length>0&&function(e,t,r,i){const n=le.isWebGL2;null===J&&(J=new Se(1,1,{generateMipmaps:!0,type:oe.has("EXT_color_buffer_half_float")?S:x,minFilter:b,samples:n?4:0}));w.getDrawingBufferSize(te),n?J.setSize(te.x,te.y):J.setSize(ie(te.x),ie(te.y));const s=w.getRenderTarget();w.setRenderTarget(J),w.getClearColor(z),H=w.getClearAlpha(),H<1&&w.setClearColor(16777215,.5);w.clear();const o=w.toneMapping;w.toneMapping=a,Ye(e,r,i),pe.updateMultisampleRenderTarget(J),pe.updateRenderTargetMipmap(J);let l=!1;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.object,a=n.geometry,o=n.material,h=n.group;if(2===o.side&&s.layers.test(i.layers)){const e=o.side;o.side=1,o.needsUpdate=!0,Ke(s,r,i,a,o,h),o.side=e,o.needsUpdate=!0,l=!0}}!0===l&&(pe.updateMultisampleRenderTarget(J),pe.updateRenderTargetMipmap(J));w.setRenderTarget(s),w.setClearColor(z,H),w.toneMapping=o}(n,s,t,r),i&&he.viewport(O.copy(i)),n.length>0&&Ye(n,t,r),s.length>0&&Ye(s,t,r),o.length>0&&Ye(o,t,r),he.buffers.depth.setTest(!0),he.buffers.depth.setMask(!0),he.buffers.color.setMask(!0),he.setPolygonOffset(!1)}function Ye(e,t,r){const i=!0===t.isScene?t.overrideMaterial:null;for(let n=0,s=e.length;n<s;n++){const s=e[n],a=s.object,o=s.geometry,l=null===i?s.material:i,h=s.group;a.layers.test(r.layers)&&Ke(a,t,r,o,l,h)}}function Ke(e,t,r,i,n,s){e.onBeforeRender(w,t,r,i,n,s),e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),n.onBeforeRender(w,t,r,i,e,s),!0===n.transparent&&2===n.side&&!1===n.forceSinglePass?(n.side=1,n.needsUpdate=!0,w.renderBufferDirect(r,t,i,n,e,s),n.side=0,n.needsUpdate=!0,w.renderBufferDirect(r,t,i,n,e,s),n.side=2):w.renderBufferDirect(r,t,i,n,e,s),e.onAfterRender(w,t,r,i,n,s)}function Ze(e,t,r){!0!==t.isScene&&(t=ne);const i=de.get(e),n=_.state.lights,s=_.state.shadowsArray,a=n.state.version,o=be.getParameters(e,n.state,s,t,r),l=be.getProgramCacheKey(o);let h=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=(e.isMeshStandardMaterial?me:fe).get(e.envMap||i.environment),void 0===h&&(e.addEventListener("dispose",He),h=new Map,i.programs=h);let u=h.get(l);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===a)return Qe(e,o),u}else o.uniforms=be.getUniforms(e),e.onBuild(r,o,w),e.onBeforeCompile(o,w),u=be.acquireProgram(o,l),h.set(l,u),i.uniforms=o.uniforms;const c=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(c.clippingPlanes=Me.uniform),Qe(e,o),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=a,i.needsLights&&(c.ambientLightColor.value=n.state.ambient,c.lightProbe.value=n.state.probe,c.directionalLights.value=n.state.directional,c.directionalLightShadows.value=n.state.directionalShadow,c.spotLights.value=n.state.spot,c.spotLightShadows.value=n.state.spotShadow,c.rectAreaLights.value=n.state.rectArea,c.ltc_1.value=n.state.rectAreaLTC1,c.ltc_2.value=n.state.rectAreaLTC2,c.pointLights.value=n.state.point,c.pointLightShadows.value=n.state.pointShadow,c.hemisphereLights.value=n.state.hemi,c.directionalShadowMap.value=n.state.directionalShadowMap,c.directionalShadowMatrix.value=n.state.directionalShadowMatrix,c.spotShadowMap.value=n.state.spotShadowMap,c.spotLightMatrix.value=n.state.spotLightMatrix,c.spotLightMap.value=n.state.spotLightMap,c.pointShadowMap.value=n.state.pointShadowMap,c.pointShadowMatrix.value=n.state.pointShadowMatrix);const d=u.getUniforms(),p=_r.seqWithValue(d.seq,c);return i.currentProgram=u,i.uniformsList=p,u}function Qe(e,t){const r=de.get(e);r.outputColorSpace=t.outputColorSpace,r.instancing=t.instancing,r.instancingColor=t.instancingColor,r.skinning=t.skinning,r.morphTargets=t.morphTargets,r.morphNormals=t.morphNormals,r.morphColors=t.morphColors,r.morphTargetsCount=t.morphTargetsCount,r.numClippingPlanes=t.numClippingPlanes,r.numIntersection=t.numClipIntersection,r.vertexAlphas=t.vertexAlphas,r.vertexTangents=t.vertexTangents,r.toneMapping=t.toneMapping}Xe.setAnimationLoop((function(e){ke&&ke(e)})),"undefined"!=typeof self&&Xe.setContext(self),this.setAnimationLoop=function(e){ke=e,null===e?Xe.stop():Xe.start()},this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==C){if(!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===e.isScene&&e.onBeforeRender(w,e,t,P),_=ye.get(e,y.length),_.init(),y.push(_),ee.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),Z.setFromProjectionMatrix(ee),$=this.localClippingEnabled,Q=Me.init(this.clippingPlanes,$),g=Te.get(e,E.length),g.init(),E.push(g),je(e,t,0,w.sortObjects),g.finish(),!0===w.sortObjects&&g.sort(X,j),this.info.render.frame++,!0===Q&&Me.beginShadows(),!0===Q&&Me.endShadows(),!0===this.info.autoReset&&this.info.reset(),we.render(g,e),_.setupLights(w._useLegacyLights),t.isArrayCamera){const r=t.cameras;for(let t=0,i=r.length;t<i;t++){const i=r[t];qe(g,e,i,i.viewport)}}else qe(g,e,t);null!==P&&(pe.updateMultisampleRenderTarget(P),pe.updateRenderTargetMipmap(P)),!0===e.isScene&&e.onAfterRender(w,e,t),Pe.resetDefaultState(),U=-1,F=null,y.pop(),_=y.length>0?y[y.length-1]:null,E.pop(),g=E.length>0?E[E.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return L},this.getActiveMipmapLevel=function(){return D},this.getRenderTarget=function(){return P},this.setRenderTargetTextures=function(e,t,r){de.get(e.texture).__webglTexture=t,de.get(e.depthTexture).__webglTexture=r;const i=de.get(e);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===r,i.__autoAllocateDepthBuffer||!0===oe.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const r=de.get(e);r.__webglFramebuffer=t,r.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,r=0){P=e,L=t,D=r;let i=!0,n=null,s=!1,a=!1;if(e){const o=de.get(e);void 0!==o.__useDefaultFramebuffer?(he.bindFramebuffer(Oe.FRAMEBUFFER,null),i=!1):void 0===o.__webglFramebuffer?pe.setupRenderTarget(e):o.__hasExternalTextures&&pe.rebindTextures(e,de.get(e.texture).__webglTexture,de.get(e.depthTexture).__webglTexture);const l=e.texture;(l.isData3DTexture||l.isDataArrayTexture||l.isCompressedArrayTexture)&&(a=!0);const h=de.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=Array.isArray(h[t])?h[t][r]:h[t],s=!0):n=le.isWebGL2&&e.samples>0&&!1===pe.useMultisampledRTT(e)?de.get(e).__webglMultisampledFramebuffer:Array.isArray(h)?h[r]:h,O.copy(e.viewport),I.copy(e.scissor),G=e.scissorTest}else O.copy(q).multiplyScalar(V).floor(),I.copy(Y).multiplyScalar(V).floor(),G=K;if(he.bindFramebuffer(Oe.FRAMEBUFFER,n)&&le.drawBuffers&&i&&he.drawBuffers(e,n),he.viewport(O),he.scissor(I),he.setScissorTest(G),s){const i=de.get(e.texture);Oe.framebufferTexture2D(Oe.FRAMEBUFFER,Oe.COLOR_ATTACHMENT0,Oe.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,r)}else if(a){const i=de.get(e.texture),n=t||0;Oe.framebufferTextureLayer(Oe.FRAMEBUFFER,Oe.COLOR_ATTACHMENT0,i.__webglTexture,r||0,n)}U=-1},this.readRenderTargetPixels=function(e,t,r,i,n,s,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=de.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){he.bindFramebuffer(Oe.FRAMEBUFFER,o);try{const a=e.texture,o=a.format,l=a.type;if(o!==A&&De.convert(o)!==Oe.getParameter(Oe.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const h=l===S&&(oe.has("EXT_color_buffer_half_float")||le.isWebGL2&&oe.has("EXT_color_buffer_float"));if(!(l===x||De.convert(l)===Oe.getParameter(Oe.IMPLEMENTATION_COLOR_READ_TYPE)||l===M&&(le.isWebGL2||oe.has("OES_texture_float")||oe.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-i&&r>=0&&r<=e.height-n&&Oe.readPixels(t,r,i,n,De.convert(o),De.convert(l),s)}finally{const e=null!==P?de.get(P).__webglFramebuffer:null;he.bindFramebuffer(Oe.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,r=0){const i=Math.pow(2,-r),n=Math.floor(t.image.width*i),s=Math.floor(t.image.height*i);pe.setTexture2D(t,0),Oe.copyTexSubImage2D(Oe.TEXTURE_2D,r,0,0,e.x,e.y,n,s),he.unbindTexture()},this.copyTextureToTexture=function(e,t,r,i=0){const n=t.image.width,s=t.image.height,a=De.convert(r.format),o=De.convert(r.type);pe.setTexture2D(r,0),Oe.pixelStorei(Oe.UNPACK_FLIP_Y_WEBGL,r.flipY),Oe.pixelStorei(Oe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),Oe.pixelStorei(Oe.UNPACK_ALIGNMENT,r.unpackAlignment),t.isDataTexture?Oe.texSubImage2D(Oe.TEXTURE_2D,i,e.x,e.y,n,s,a,o,t.image.data):t.isCompressedTexture?Oe.compressedTexSubImage2D(Oe.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,a,t.mipmaps[0].data):Oe.texSubImage2D(Oe.TEXTURE_2D,i,e.x,e.y,a,o,t.image),0===i&&r.generateMipmaps&&Oe.generateMipmap(Oe.TEXTURE_2D),he.unbindTexture()},this.copyTextureToTexture3D=function(e,t,r,i,n=0){const s=e.max.x-e.min.x+1,a=e.max.y-e.min.y+1,o=e.max.z-e.min.z+1,l=De.convert(i.format),h=De.convert(i.type);let u;if(i.isData3DTexture)pe.setTexture3D(i,0),u=Oe.TEXTURE_3D;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");pe.setTexture2DArray(i,0),u=Oe.TEXTURE_2D_ARRAY}Oe.pixelStorei(Oe.UNPACK_FLIP_Y_WEBGL,i.flipY),Oe.pixelStorei(Oe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Oe.pixelStorei(Oe.UNPACK_ALIGNMENT,i.unpackAlignment);const c=Oe.getParameter(Oe.UNPACK_ROW_LENGTH),d=Oe.getParameter(Oe.UNPACK_IMAGE_HEIGHT),p=Oe.getParameter(Oe.UNPACK_SKIP_PIXELS),f=Oe.getParameter(Oe.UNPACK_SKIP_ROWS),m=Oe.getParameter(Oe.UNPACK_SKIP_IMAGES),g=r.isCompressedTexture?r.mipmaps[0]:r.image;Oe.pixelStorei(Oe.UNPACK_ROW_LENGTH,g.width),Oe.pixelStorei(Oe.UNPACK_IMAGE_HEIGHT,g.height),Oe.pixelStorei(Oe.UNPACK_SKIP_PIXELS,e.min.x),Oe.pixelStorei(Oe.UNPACK_SKIP_ROWS,e.min.y),Oe.pixelStorei(Oe.UNPACK_SKIP_IMAGES,e.min.z),r.isDataTexture||r.isData3DTexture?Oe.texSubImage3D(u,n,t.x,t.y,t.z,s,a,o,l,h,g.data):r.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Oe.compressedTexSubImage3D(u,n,t.x,t.y,t.z,s,a,o,l,g.data)):Oe.texSubImage3D(u,n,t.x,t.y,t.z,s,a,o,l,h,g),Oe.pixelStorei(Oe.UNPACK_ROW_LENGTH,c),Oe.pixelStorei(Oe.UNPACK_IMAGE_HEIGHT,d),Oe.pixelStorei(Oe.UNPACK_SKIP_PIXELS,p),Oe.pixelStorei(Oe.UNPACK_SKIP_ROWS,f),Oe.pixelStorei(Oe.UNPACK_SKIP_IMAGES,m),0===n&&i.generateMipmaps&&Oe.generateMipmap(u),he.unbindTexture()},this.initTexture=function(e){e.isCubeTexture?pe.setTextureCube(e,0):e.isData3DTexture?pe.setTexture3D(e,0):e.isDataArrayTexture||e.isCompressedArrayTexture?pe.setTexture2DArray(e,0):pe.setTexture2D(e,0),he.unbindTexture()},this.resetState=function(){L=0,D=0,P=null,he.reset(),Pe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Y}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===G?"display-p3":"srgb",t.unpackColorSpace=fe.workingColorSpace===z?"display-p3":"srgb"}get physicallyCorrectLights(){return!this.useLegacyLights}set physicallyCorrectLights(e){this.useLegacyLights=!e}get outputEncoding(){return this.outputColorSpace===B?O:3e3}set outputEncoding(e){this.outputColorSpace=e===O?B:N}get useLegacyLights(){return this._useLegacyLights}set useLegacyLights(e){this._useLegacyLights=e}},e.SRGBColorSpace=B}))},{}]},{},[13]);
